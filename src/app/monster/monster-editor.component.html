<div *ngIf="monster">
    <div>
        <mat-select class="type-selector" (change)="selectType($event.value)" [ngModel]="selectedType" placeholder="Catégorie">
            <mat-option *ngFor="let type of types" [value]="type">{{type.name}}</mat-option>
            <mat-option [value]="undefined">
                <span class="secondary-text">
                    Ajouter...
                </span>
            </mat-option>
        </mat-select>
        <mat-select class="category-selector" *ngIf="selectedType" [ngModel]="monster.category" (change)="selectCategory($event.value)" placeholder="Sous-catégorie">
            <mat-option *ngFor="let category of selectedType.categories" [value]="category">
                {{category.name}}
            </mat-option>
            <mat-option [value]="undefined">
                <span class="secondary-text">
                    Ajouter...
                </span>
            </mat-option>
        </mat-select>
    </div>

    <div>
        <mat-form-field>
            <input matInput
                   placeholder="Nom"
                   [(ngModel)]="monster.name">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   type="number"
                   placeholder="Page du bestiaire"
                   [(ngModel)]="monster.data.page">
        </mat-form-field>
        <mat-button-toggle-group [(ngModel)]="defenseStat" (change)="updateDefenseStat()">
            <mat-button-toggle [value]="'PRD'">PRD</mat-button-toggle>
            <mat-button-toggle [value]="'ESQ'">ESQ</mat-button-toggle>
        </mat-button-toggle-group>
        <mat-checkbox [(ngModel)]="monster.data.chercheNoise">
            Chercher des noises
        </mat-checkbox>
    </div>

    <div>
        <mat-form-field>
            <input matInput
                   type="number"
                   placeholder="AT"
                   [(ngModel)]="monster.data.at">
        </mat-form-field>
        <mat-form-field *ngIf="defenseStat === 'PRD'">
            <input matInput
                   type="number"
                   placeholder="PRD"
                   [(ngModel)]="monster.data.prd">
        </mat-form-field>
        <mat-form-field *ngIf="defenseStat === 'ESQ'">
            <input matInput
                   type="number"
                   placeholder="ESQ"
                   [(ngModel)]="monster.data.esq">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   type="number"
                   placeholder="EV"
                   [(ngModel)]="monster.data.ev">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   placeholder="PR"
                   [(ngModel)]="monster.data.pr">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   type="number"
                   placeholder="COU"
                   [(ngModel)]="monster.data.cou">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   type="number"
                   placeholder="RESM"
                   [(ngModel)]="monster.data.resm">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   placeholder="DMG"
                   [(ngModel)]="monster.data.dmg">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   type="number"
                   placeholder="XP"
                   [(ngModel)]="monster.data.xp">
        </mat-form-field>
        <mat-form-field>
            <input matInput
                   type="number"
                   placeholder="EA"
                   [(ngModel)]="monster.data.ea">
        </mat-form-field>
    </div>

    <div>
        <mat-form-field style="width: 100%">
            <textarea matInput
                      md-textarea-autosize
                      [(ngModel)]="monster.data.note"
                      placeholder="Note">
            </textarea>
        </mat-form-field>
    </div>
    <div>
        <div>Traits simple</div>
        <div>
            <ng-template ngFor let-trait [ngForOf]=simpleTraits>
                <button *ngIf="hasTrait(trait)"
                        mat-raised-button
                        type="button"
                        class="btn btn-default"
                        color="primary"
                        (click)="toggleTrait(trait)">
                    {{trait.name}}
                </button>
                <button *ngIf="!hasTrait(trait)"
                        mat-button
                        type="button"
                        class="btn btn-default"
                        color="primary"
                        (click)="toggleTrait(trait)">
                    {{trait.name}}
                </button>
            </ng-template>
        </div>
    </div>
    <div>
        <div>Traits</div>
        <div>
            <div class="btn-group" role="group">
                <ng-template ngFor let-trait [ngForOf]=powerTraits>
                    <button *ngIf="!hasTrait(trait)"
                            mat-button
                            type="button"
                            class="btn btn-default"
                            color="primary"
                            (click)="toggleTrait(trait)">
                        {{trait.name}}
                    </button>
                    <button *ngIf="hasTrait(trait)"
                            mat-raised-button
                            type="button"
                            class="btn btn-default"
                            [color]="hasTraitLevel(trait, 1) ? 'primary' : (hasTraitLevel(trait, 2) ? 'accent' : 'warn')"
                            (click)="toggleTrait(trait)">
                        {{trait.name}}
                    </button>
                </ng-template>
            </div>
        </div>
    </div>
    <div>
        <div *ngIf="locationsById">
            <span style="border-radius: 4px; background-color: #7aa09b; margin-right: 5px"
                  *ngFor="let locationId of monster.locations">
                {{locationsById[locationId].name}} <span (click)="removeLocation(locationId)">X</span>
            </span>
            <autocomplete-input [placeholder]="'Lieu'"
                                [value]="locationSearchName" (onSelect)="selectLocation($event)"
                                [(callback)]="autocompleteLocationsCallback"></autocomplete-input>

        </div>
    </div>
    <div>
        <autocomplete-search-item-template [clearOnSelect]="true"
                                           [placeholder]="'Ajouter un objet dans l\'inventaire'"
                                           (onSelect)="addItemSimpleInventory($event)">
        </autocomplete-search-item-template>
    </div>
    <mat-card *ngIf="monster.simpleInventory && monster.simpleInventory.length">
        <mat-card-subtitle>Inventaire</mat-card-subtitle>
        <ng-template ngFor let-inventory [ngForOf]="monster.simpleInventory" let-i="index">
            <div>
                <button mat-icon-button (click)="removeItemSimpleInventory(i)">
                    <mat-icon>delete</mat-icon>
                </button>
                {{inventory.itemTemplate.name}}
            </div>
            <div>
                <mat-form-field>
                    <input matInput type="number" min=0 [(ngModel)]="inventory.minCount" placeholder="Quantité min" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" min=0 [(ngModel)]="inventory.maxCount" placeholder="Quantité max" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput type="number" min=0 step="0.0001" [(ngModel)]="inventory.chance" placeholder="Chance" />
                </mat-form-field>
                <mat-checkbox [(ngModel)]="inventory.equiped">Equipé</mat-checkbox>
                <mat-checkbox [(ngModel)]="inventory.hidden">Caché</mat-checkbox>
            </div>
        </ng-template>
    </mat-card>
</div>

<ng-template cdk-portal #createCategoryDialog="cdkPortal">
    <mat-card>
        <mat-card-title>Créer une sous-catégorie de {{selectedType.name}}</mat-card-title>
        <mat-card-content>
            <mat-form-field style="width: 100%">
                <input matInput placeholder="Nom" #newCategoryName/>
            </mat-form-field>
        </mat-card-content>
        <mat-card-actions align="right">
            <button mat-button (click)="closeCreateCategoryDialog()" color="primary">Annuler</button>
            <button mat-button (click)="createCategory(newCategoryName.value)" color="primary">Créer</button>
        </mat-card-actions>
    </mat-card>
</ng-template>

<ng-template cdk-portal #createTypeDialog="cdkPortal">
    <mat-card>
        <mat-card-title>Créer une catégorie</mat-card-title>
        <mat-card-content>
            <mat-form-field style="width: 100%">
                <input matInput placeholder="Nom" #newTypeName/>
            </mat-form-field>
        </mat-card-content>
        <mat-card-actions align="right">
            <button mat-button (click)="closeCreateTypeDialog()" color="primary">Annuler</button>
            <button mat-button (click)="createType(newTypeName.value)" color="primary">Créer</button>
        </mat-card-actions>
    </mat-card>
</ng-template>
