<div class="fighter-card mat-elevation-z4" *ngIf="group.data.inCombat && group.currentFighter">
    <h2 class="mat-h2">
        Combattant actuel
    </h2>
    <fighter [selected]="false"
             [group]="group"
             [fighter]="group.currentFighter"
             [expandedView]="true"
             [fighters]="group.fighters">
    </fighter>
</div>

<div class="next-button">
    <button
        mat-raised-button
        color="primary"
        [disabled]="loadingNextLap || group.fighters.length < 2"
        (click)="selectNextFighter()"
        aria-label="Combattant suivant">
        Suivant
        <mat-icon>
            navigate_next
        </mat-icon>
    </button>
</div>

<div class="fighter-card  mat-elevation-z2">
    <h2 class="mat-h2">
        Combattants
        <span>
            <button mat-icon-button [matMenuTriggerFor]="menuCharacter"
                    aria-label="Ouvrir le menu des combatants">
                <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menuCharacter="matMenu">
                <button mat-menu-item
                        *ngIf="!group?.data?.inCombat"
                        (click)="startCombat()">
                    <mat-icon>play_arrow</mat-icon>
                    Debut combat
                </button>
                <button mat-menu-item
                        *ngIf="group.data.inCombat"
                        (click)="endCombat()">
                    <mat-icon>stop</mat-icon>
                    Fin combat
                </button>
                <button mat-menu-item
                        (click)="openAddMonsterDialog()">
                    <mat-icon>add</mat-icon>
                    Ajouter un monstre
                </button>
                <button mat-menu-item
                        (click)="openDeadMonstersDialog()">
                    <mat-icon fontSet="game-icon" fontIcon="game-icon-tombstone" class="ra-mat-button-icon-24"></mat-icon>
                    Monstres morts
                </button>
            </mat-menu>
        </span>
    </h2>
    <mat-divider></mat-divider>
    <ng-template ngFor let-fighter [ngForOf]="group.fighters" let-i=index>
        <fighter
            [selected]="(!group.data.inCombat && selectedCombatRow === i) || (group.data.inCombat && group.data.currentFighterIndex === i)"
            [group]="group"
            [fighter]="fighter"
            [fighters]="group.fighters"
            [expandedView]="selectedCombatRow === i"
            (onSelect)="selectFighter($event)">
        </fighter>
        <mat-divider></mat-divider>
    </ng-template>


    <ng-template #deadMonstersDialog="cdkPortal" cdk-portal>
        <mat-card class="dead-monsters-dialog">
            <mat-card-title>Monstres morts</mat-card-title>
            <mat-card-content class="dead-monsters-list">
                <table class="table table-striped table-condensed text-center">
                    <thead>
                    <tr>
                        <th class="text-center">Nom</th>
                        <th class="text-center">XP</th>
                        <th class="text-center">Notes</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <ng-template ngFor let-element [ngForOf]="deadMonsters">
                        <tr>
                            <td>{{element.name}}</td>
                            <td>{{element.data.xp}}</td>
                            <td>{{element.note}}</td>
                        </tr>
                    </ng-template>
                    </tbody>
                </table>
            </mat-card-content>
            <mat-card-actions align="end">
                <button mat-button
                        color="primary"
                        [disabled]="allDeadMonstersLoaded"
                        (click)="loadMoreDeadMonsters()">CHARGER PLUS
                </button>
                <button mat-button
                        color="primary"
                        (click)="closeDeadMonstersDialog()">FERMER
                </button>
            </mat-card-actions>
        </mat-card>
    </ng-template>
</div>
