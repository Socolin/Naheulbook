<div class="loot-tab">
    <div class="loot-list">
        <mat-card *ngFor="let loot of character.loots">
            <mat-card-title>{{loot.name}}</mat-card-title>
            <mat-card-content>
                <div class="loot-items">
                    <ng-template ngFor let-item [ngForOf]="loot.items">
                        <div class="loot-item"
                             matRipple
                             (click)="selectItem(item)"
                             cdk-overlay-origin
                             #itemLine="cdkOverlayOrigin"
                             [class.active]="item.id == selectedItem?.id">
                            <button mat-mini-fab
                                    (click)="openTakeItemLootDialog(loot, item)">
                                <mat-icon fontSet="game-icon" fontIcon="game-icon-snatch" class="ra-mat-button-icon-24">
                                </mat-icon>
                            </button>
                            &nbsp;
                            <icon [icon]="item.data.icon" [size]="'32px'"></icon>
                            <span *ngIf="item.template.data.quantifiable">{{item.data.quantity}}&nbsp;</span>
                            {{item.data.name}}
                            <swipeable-item-detail *ngIf="item.id === selectedItem?.id"
                                                   [character]="character"
                                                   [origin]="itemLine"
                                                   [item]="item"
                                                   [readonly]="true">
                            </swipeable-item-detail>
                        </div>
                    </ng-template>
                </div>
                <div class="loot-monsters" *ngFor="let monster of loot.monsters">
                    <div>
                        <span class="mat-title">{{monster.name}}</span>
                    </div>
                    <div class="monster-item loot-item" *ngFor="let item of monster.items"
                         (click)="selectItem(item)"
                         matRipple
                         cdk-overlay-origin
                         #itemLine="cdkOverlayOrigin"
                         [class.active]="item.id == selectedItem?.id">
                        <button mat-mini-fab
                                (click)="openTakeItemMonsterDialog(monster, item)">
                            <mat-icon fontSet="game-icon" fontIcon="game-icon-snatch" class="ra-mat-button-icon-24">
                            </mat-icon>
                        </button>
                        &nbsp;
                        <icon [icon]="item.data.icon" [size]="'32px'"></icon>
                        <span *ngIf="item.template.data.quantifiable">{{item.data.quantity}}&nbsp;</span>
                        {{item.data.name}}
                        <swipeable-item-detail *ngIf="item.id === selectedItem?.id"
                                               [character]="character"
                                               [origin]="itemLine"
                                               [item]="item"
                                               [readonly]="true">
                        </swipeable-item-detail>
                    </div>
                </div>

            </mat-card-content>
        </mat-card>
    </div>
    <div *ngIf="selectedItem" class="item-detail">
        <item-detail [gmView]="inGroupTab"
                     [character]="character"
                     [item]="selectedItem"
                     [readonly]="true"></item-detail>
    </div>
</div>

<ng-template cdk-portal #takeItemDialog="cdkPortal">
    <mat-card>
        <mat-card-title>Loot</mat-card-title>
        <mat-card-content *ngIf="!takingItem.data.quantity || takingItem.data.quantity < 2">
            Prendre l'objet {{takingItem.data.name}} ?
        </mat-card-content>
        <mat-card-content *ngIf="takingItem.data.quantity > 1">
            Prendre l'objet
            <value-editor [title]="'QuantitÃ©'"
                          [hideMaxValue]="true"
                          [value]="takingQuantity"
                          (onChange)="takingQuantity = $event"
                          [maxValue]="takingItem.data.quantity">
            </value-editor>
            {{takingItem.data.name}} ?
        </mat-card-content>
        <mat-card-actions align="end">
            <button mat-button
                    color="primary"
                    (click)="closeTakeItemDialog()">
                ANNULER
            </button>
            <button mat-button
                    color="primary"
                    (click)="validTakeItem()">
                PRENDRE
            </button>
        </mat-card-actions>
    </mat-card>
</ng-template>

