<div class="effect-panel">
    <md-card class="effect-list-panel">
        <md-card-title>
            Effets
        </md-card-title>
        <md-card-content>
            <div class="effect-list">
                <ng-template ngFor let-characterEffect [ngForOf]="character.computedData.effects" let-i="index" let-last="last">
                    <div (click)="selectEffect(characterEffect)"
                         class="effect-element"
                         [class.selected]="selectedEffect === characterEffect">
                        <span *ngIf="characterEffect.reusable">
                            <md-slide-toggle color="primary"
                                             (change)="updateReusableEffect(characterEffect)"
                                             [ngModel]="characterEffect.active">
                            </md-slide-toggle>
                        </span>
                        <span *ngIf="!characterEffect.reusable" class="toggle-padding"></span>
                        <span class="padding"
                              (click)="selectEffect(characterEffect)">
                            {{characterEffect.effect.name}}
                        </span>
                        <span *ngIf="characterEffect.currentCombatCount !== null">
                            <span class="ra ra-sword duration-icon"></span>{{characterEffect.currentCombatCount}}
                        </span>
                        <span *ngIf="characterEffect.currentTimeDuration">
                            <span class="ra ra-clockwork duration-icon"></span> {{characterEffect.currentTimeDuration | nhbkDuration}}
                        </span>
                        <span *ngIf="characterEffect.currentLapCount">
                            <span class="game-icon game-icon-clockwise-rotation duration-icon"></span> {{characterEffect.currentLapCount}}
                        </span>
                    </div>
                </ng-template>
                <ng-template ngFor let-modifier [ngForOf]="character.computedData.modifiers" let-i="index" let-last="last">
                    <div *ngIf="!modifier.permanent"
                         class="effect-element"
                         [class.selected]="selectedModifier === modifier">
                        <span *ngIf="modifier.reusable">
                            <md-slide-toggle color="primary"
                                             (change)="updateReusableModifier(modifier)"
                                             [ngModel]="modifier.active">
                            </md-slide-toggle>
                        </span>
                        <span *ngIf="!modifier.reusable" class="toggle-padding"></span>
                        <span class="padding"
                              (click)="selectModifier(modifier)">
                            {{modifier.name}}
                        </span>
                        <span *ngIf="modifier.combatCount">
                            <span class="ra ra-sword duration-icon"></span> {{modifier.currentCombatCount}}
                        </span>
                        <span *ngIf="modifier.currentTimeDuration">
                            <span class="ra ra-clockwork duration-icon"></span> {{modifier.currentTimeDuration | nhbkDuration}}
                        </span>
                        <span *ngIf="modifier.currentLapCount">
                            <span class="game-icon game-icon-clockwise-rotation duration-icon"></span> {{modifier.currentLapCount}}
                        </span>
                    </div>
                </ng-template>
            </div>
        </md-card-content>
        <md-card-actions align="end">
            <button md-button color="primary" (click)="openAddEffectModal()">AJOUTER</button>
        </md-card-actions>
    </md-card>
    <div *ngIf="selectedEffect" class="effect-detail-panel">
        <effect-detail [characterEffect]="selectedEffect" [effectCategoriesById]="effectCategoriesById" (onRemove)="removeEffect($event)"></effect-detail>
    </div>
    <div *ngIf="selectedModifier" class="effect-detail-panel">
        <modifier-detail [activeModifier]="selectedModifier" (onRemove)="removeModifier($event)"></modifier-detail>
    </div>
</div>


<ng-template #addEffectDialog="cdkPortal" cdk-portal>
    <md-card class="add-effect-dialog">
        <md-card-title>Ajouter un effet</md-card-title>
        <md-card-content>
            <md-tab-group (selectedIndexChange)="selectEffectTypeTab($event)">
                <md-tab label="Prédéfini">
                    <active-effect-editor #activeEffectEditor
                                          (onValidate)="addEffect($event)">
                    </active-effect-editor>
                </md-tab>

                <md-tab label="Custom">
                    <stats-modifier-editor [modifier]="newActiveStatsModifier">
                    </stats-modifier-editor>
                </md-tab>
            </md-tab-group>
        </md-card-content>
        <md-card-actions align="end">
            <button md-button
                    color="primary"
                    (click)="closeAddEffectDialog()">
                ANNULER
            </button>
            <button md-button
                    color="primary"
                    *ngIf="addEffectTypeSelectedTab === 0"
                    (click)="activeEffectEditor.addEffect()">
                AJOUTER
            </button>
            <button md-button
                    color="primary"
                    *ngIf="addEffectTypeSelectedTab === 1"
                    (click)="addCustomModifier()">
                AJOUTER
            </button>
        </md-card-actions>
    </md-card>
</ng-template>
