<div *ngIf="character" class="character-component">
    <md-tab-group (selectChange)=selectTab($event) [selectedIndex]="currentTabIndex">
        <md-tab label="Info">
            <!-- Start of info tab -->
            <div class="info-tab">
                <md-card *ngFor="let invite of character.invites">
                    <md-card-title>Invitation</md-card-title>
                    <md-card-content>
                        Rejoindre le groupe <em>{{invite.name}}</em> ?
                    </md-card-content>
                    <md-card-actions>
                        <button md-button color="primary" (click)="cancelInvite(invite)">REFUSER</button>
                        <button md-button color="primary" (click)="acceptInvite(invite)">ACCEPTER</button>
                    </md-card-actions>
                </md-card>

                <md-card>
                    <md-card-title>{{character.name}}</md-card-title>
                    <md-card-content>
                        <dl>
                            <dt>Origine</dt>
                            <dd>{{character.origin.name}}</dd>

                            <dt>Metier</dt>
                            <dd *ngIf="character.job">{{character.job.name}}</dd>
                            <dd *ngIf="!character.job">aucun</dd>

                            <dt>Specialité</dt>
                            <dd *ngFor="let speciality of character.specialities">
                                {{speciality.name}}
                            </dd>

                            <dt>Groupe</dt>
                            <dd *ngIf="character.group">{{character.group.name}}</dd>
                            <dd *ngIf="!character.group">aucun</dd>


                            <dt>Sexe</dt>
                            <dd>{{character.sex}}</dd>

                            <dt>Point de destins</dt>
                            <dd>
                                <value-editor [title]="'Point de destin'"
                                              [value]=character.fatePoint
                                              (onChange)="changeCharacterStat('fatePoint', $event)">
                                </value-editor>
                            </dd>

                            <dt>Niveau</dt>
                            <dd>{{character.level}}
                                <button class="level-up-button"
                                        md-raised-button
                                        *ngIf="canLevelUp()"
                                        color="primary"
                                        (click)="openLevelUpDialog()">
                                    Ding !
                                </button>
                            </dd>

                            <dt>Experience</dt>
                            <dd>
                                <value-editor [title]="'Experience'"
                                              [value]=character.experience
                                              (onChange)="changeCharacterStat('experience', $event)">
                                </value-editor> / {{character.computedData.xpToNextLevel}}
                            </dd>

                            <dt>Fortune</dt>
                            <dd>
                                {{character.computedData.totalMoney | number}} Pieces d'or
                            </dd>

                            <dt *ngIf="inGroupTab">Debilibeuk</dt>
                            <dd *ngIf="inGroupTab">
                                <value-editor [title]="'Debilibeuk du joueur'" [value]=character.gmData.debilibeuk
                                              (onChange)="changeGmData('debilibeuk', $event)"></value-editor>
                            </dd>

                            <dt *ngIf="inGroupTab">Mankdebol</dt>
                            <dd *ngIf="inGroupTab">
                                <value-editor [title]="'Mankdebol du joueur'" [value]=character.gmData.mankdebol
                                              (onChange)="changeGmData('mankdebol', $event)"></value-editor>
                            </dd>
                        </dl>
                    </md-card-content>
                </md-card>
                <md-card *ngIf="character.computedData.stats['AD'] > 12">
                    <md-card-title>Adresse exceptionnelle</md-card-title>
                    <md-card-content>
                        <p>
                            Un score d'adresse (AD) exceptionnelle confère un point <em>bonus</em> en attaque (AT) ou en parade (PRD)
                        </p>
                        <md-button-toggle-group name="alignment" [(ngModel)]="character.statBonusAD">
                            <md-button-toggle value="AT" (click)="setStatBonusAD(character.id, 'AT')">AT</md-button-toggle>
                            <md-button-toggle value="PRD" (click)="setStatBonusAD(character.id, 'PRD')">PRD</md-button-toggle>
                        </md-button-toggle-group>
                    </md-card-content>
                </md-card>
                <md-card *ngIf="character.computedData.stats['AD'] < 9" class="row">
                    <md-card-title>Adresse pourri</md-card-title>
                    <md-card-content>
                        <p>
                            Un score d'adresse (AD) inférieur ou égale à 8 induit un point <em>malus</em> en attaque (AT) ou en parade (PRD)
                        </p>
                        <md-button-toggle-group name="alignment" [(ngModel)]="character.statBonusAD">
                            <md-button-toggle value="AT" (click)="setStatBonusAD(character.id, 'AT')">AT</md-button-toggle>
                            <md-button-toggle value="PRD" (click)="setStatBonusAD(character.id, 'PRD')">PRD</md-button-toggle>
                        </md-button-toggle-group>
                    </md-card-content>
                </md-card>
                <md-card *ngIf="character.computedData.stats['INT'] > 12">
                    <md-card-title>Intelligence exceptionnelle</md-card-title>
                    <md-card-content>
                        <p>
                            Un score d'inteligence (INT) exceptionnelle confère un point de dégâts des sorts
                            (selon sortilège) pour chaque point d'inteligence supérieur à 12.
                        </p>
                        <div>Bonus dégâts des sorts: {{(character.computedData.stats['INT'] - 12)}}</div>
                    </md-card-content>
                </md-card>
                <md-card *ngIf="character.computedData.stats['FO'] > 12">
                    <md-card-title>Force exceptionnelle</md-card-title>
                    <md-card-content>
                        <p>
                            Un score exceptionnel offre forcément des avantages dans ce monde violent...
                        </p>
                        <p>
                            Pour chaque point de force (FO) supérieur à 12 : +1 point d’impact (dégâts des armes améliorés au corps à corps ou à distance)
                        </p>
                        <div>Bonus point d'impact: {{(character.computedData.stats['FO'] - 12)}}</div>
                    </md-card-content>
                </md-card>
                <md-card *ngIf="character.computedData.stats['FO'] <= 8">
                    <md-card-title>Force de mauviette</md-card-title>
                    <md-card-content>
                        <p>
                            Un score exceptionnel offre forcément des avantages dans ce monde violent...
                            Et au contraire sur une carac. de force (FO) de 8 ou inférieure : -1 point d’impact (dégâts des armes diminués, car mauviette)
                        </p>
                        <div>Malus point d'impact: 1</div>
                    </md-card-content>
                </md-card>
            </div>
            <!-- End of infos tab -->
        </md-tab>

        <md-tab label="Combat">
            <!-- Start of combat tab -->
            <div class="combat-tab">
                <md-card class="life-mana stats-card">
                    <md-card-content>
                        <div class="stat">
                            <div class="stat-icon">
                                <span class="game-icon game-icon-hearts"></span>
                            </div>
                            <div class="stat-value">
                                <div [class.life-danger]="character.ev > character.computedData.stats['EV']">
                                    <value-editor [title]="'Energie vitale'"
                                                  [value]="character.ev"
                                                  [maxValue]="character.computedData.stats['EV']"
                                                  (onChange)="changeCharacterStat('ev', $event)">
                                    </value-editor>
                                </div>
                                <div class="stat-label">E.Vitale</div>
                            </div>
                        </div>
                        <div *ngIf="character.ea != undefined" class="stat">
                            <div class="stat-icon">
                                <span class="game-icon game-icon-abstract-061"></span>
                            </div>
                            <div class="stat-value">
                                <div [class.bg-danger]="character.ea > character.computedData.stats['EA']">
                                    <value-editor [title]="'Energie astrale'"
                                                  [value]="character.ea"
                                                  [maxValue]="character.computedData.stats['EA']"
                                                  (onChange)="changeCharacterStat('ea', $event)">
                                    </value-editor>
                                </div>
                                <div class="stat-label">E.Astrale</div>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>

                <md-card class="combat-stats stats-card">
                    <md-card-content>
                        <div class="stat-row">
                            <div class="stat">
                                <div class="stat-icon">
                                    <span class="ra ra-sword"></span>
                                </div>
                                <div class="stat-value">
                                    <div>{{character.computedData.stats['AT']}}</div>
                                    <div class="stat-label">Attaque</div>
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-icon">
                                    <span class="ra ra-shield"></span>
                                </div>
                                <div class="stat-value">
                                    <div>{{character.computedData.stats['PRD']}}</div>
                                    <div class="stat-label">Parade</div>
                                </div>
                            </div>
                        </div>
                        <div class="stat-row">
                            <div class="stat">
                                <div class="stat-icon">
                                    <span class="ra ra-vest"></span>
                                </div>
                                <div class="stat-value">
                                    <div>{{character.computedData.stats['PR']}}</div>
                                    <div class="stat-label">Protection</div>
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-icon">
                                    <span class="ra ra-aura"></span>
                                </div>
                                <div class="stat-value">
                                    <div>{{character.computedData.stats['PR_MAGIC']}}</div>
                                    <div class="stat-label">Pr magique</div>
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>

                <md-card class="basic-stats stats-card">
                    <md-card-content>
                        <div class="stat-row">
                            <div class="stat">
                                <div class="stat-name">
                                    COU
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['COU']}}
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-name">
                                    FO
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['FO']}}
                                </div>
                            </div>
                        </div>

                        <div class="stat-row">
                            <div class="stat">
                                <div class="stat-name">
                                    AD
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['AD']}}
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-name">
                                    CHA
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['CHA']}}
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>
                <md-card class="stats-card" *ngIf="character.computedData.stats['PI']
                                                || character.computedData.stats['INT'] > 12">
                    <md-card-content>
                        <div class="stat-row" *ngIf="character.computedData.stats['PI']">
                            <div class="stat large-stat">
                                <div class="stat-name">
                                    Bonus point d’impact
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['PI']}}
                                </div>
                            </div>
                        </div>

                        <div class="stat-row" *ngIf="character.computedData.stats['INT'] > 12">
                            <div *ngIf="character.computedData.stats['INT'] > 12" class="stat large-stat">
                                <div class="stat-name">
                                    Bonus dégâts des sorts
                                </div>
                                <div class="stat-value">
                                    {{(character.computedData.stats['INT'] - 12)}}
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>
                <md-card class="magic-stat stats-card">
                    <md-card-content>
                        <div class="stat-row">
                            <div class="stat">
                                <div class="stat-name">
                                    RESM
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['RESM']}}
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-name">
                                    INT
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['INT']}}
                                </div>
                            </div>
                        </div>
                        <div class="stat-row" *ngIf="character.job && character.job.isMagic">
                            <div class="stat">
                                <div class="stat-name">
                                    MPHYS
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['MPHYS']}}
                                </div>
                            </div>
                            <div class="stat">
                                <div class="stat-name">
                                    MPSY
                                </div>
                                <div class="stat-value">
                                    {{character.computedData.stats['MPSY']}}
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                </md-card>

                <md-card class="stats-card">
                    <md-card-title>Déplacement tactique</md-card-title>
                    <md-card-content>
                        <ul>
                            <li>
                                <strong>Normal</strong>
                                {{character.computedData.tacticalMovement.distance.toPrecision(2)}} m/s pendant {{character.computedData.tacticalMovement.maxDuration.toFixed(0)}} secondes
                            </li>
                            <li>
                                <strong>Sprint</strong> (Après un déplacement normal):
                                {{character.computedData.tacticalMovement.sprintDistance.toPrecision(2)}} m/s pendant {{character.computedData.tacticalMovement.sprintMaxDuration.toFixed(0)}} secondes
                            </li>
                        </ul>
                    </md-card-content>
                </md-card>
                <md-card class="stats-card weapons-card">
                    <md-card-title>Armes</md-card-title>
                    <md-card-content>
                        <div *ngIf="character.computedData.itemsBySlotsAll[1]" class="weapons-list">
                            <ng-template ngFor let-item [ngForOf]="character.computedData.itemsBySlotsAll[1]" let-i="index" let-last="last">
                                <div class="item-line"
                                     [class.selected]="selectedItem && selectedItem.id === item.id"
                                     (click)="selectItem(item)">
                                    <icon [icon]="item.data.icon" [size]="'32px'"></icon>
                                    <md-icon *ngIf="item.data.equiped !== undefined">check_circle</md-icon>
                                    <md-icon *ngIf="item.data.notIdentified">help</md-icon>
                                    <span *ngIf="item.data.quantity">{{item.data.quantity}}&nbsp;</span>
                                    {{item.data.name}}
                                </div>
                            </ng-template>
                        </div>
                    </md-card-content>
                </md-card>
                <div *ngIf="selectedItem && selectedItem.template.slots.length > 0" class="weapons-detail">
                    <item-detail [gmView]="inGroupTab" [character]="character" [item]="selectedItem"></item-detail>
                </div>
                <div #combatWeaponDetail></div>
            </div>
            <!-- End of combat tab -->
        </md-tab>
        <md-tab label="Stat">
            <!-- Start of stats tab -->
            <div class="stat-tab">
                <md-card>
                    <md-card-content>
                        <div class="stat-header">
                            <div class="stat-element">EV</div>
                            <div class="stat-element" *ngIf="character.job && character.job.isMagic">EA</div>
                        </div>
                        <div class="stat-values">
                            <div class="stat-row">
                                <div class="stat-element">{{character.computedData.stats['EV']}}</div>
                                <div *ngIf="character.job && character.job.isMagic" class="stat-element">{{character.computedData.stats['EA']}}</div>
                            </div>
                            <div class="stat-details" *ngIf="character.computedData.details.show.evea">
                                <div class="detail-row" *ngFor="let detail of character.computedData.details.evea">
                                    <div class="stat-detail-reason">
                                        {{detail.name}}
                                    </div>
                                    <div class="stat-row">
                                        <div class="stat-element">{{detail.data.EV}}</div>
                                        <div *ngIf="character.job && character.job.isMagic" class="stat-element">{{detail.data.EA}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                    <md-card-actions align="end">
                        <button md-button [color]="'primary'" (click)="character.computedData.details.show.evea = !character.computedData.details.show.evea">
                            <span *ngIf="!character.computedData.details.show.evea">Voir details</span>
                            <span *ngIf="character.computedData.details.show.evea">Cacher details</span>
                        </button>
                    </md-card-actions>
                </md-card>
                <md-card>
                    <md-card-content>
                        <div class="stat-header">
                            <div class="stat-element">AT</div>
                            <div class="stat-element">PRD</div>
                            <div class="stat-element">PR</div>
                            <div class="stat-element" *ngIf="character.computedData.stats['PR_MAGIC']">PR_MAGIC</div>
                        </div>
                        <div class="stat-values">
                            <div class="stat-row">
                                <div class="stat-element">{{character.computedData.stats['AT']}}</div>
                                <div class="stat-element">{{character.computedData.stats['PRD']}}</div>
                                <div class="stat-element">{{character.computedData.stats['PR']}}</div>
                                <div class="stat-element" *ngIf="character.computedData.stats['PR_MAGIC']">{{character.computedData.stats['PR_MAGIC']}}</div>
                            </div>
                            <div class="stat-details" *ngIf="character.computedData.details.show.atprd">
                                <div class="detail-row" *ngFor="let detail of character.computedData.details.atprd">
                                    <div class="stat-detail-reason">
                                        {{detail.name}}
                                    </div>
                                    <div class="stat-row">
                                        <div class="stat-element">{{detail.data.AT}}</div>
                                        <div class="stat-element">{{detail.data.PRD}}</div>
                                        <div class="stat-element">{{detail.data.PR}}</div>
                                        <div class="stat-element" *ngIf="character.computedData.stats['PR_MAGIC']">{{detail.data.PR_MAGIC}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                    <md-card-actions align="end">
                        <button md-button [color]="'primary'" (click)="character.computedData.details.show.atprd = !character.computedData.details.show.atprd">
                            <span *ngIf="!character.computedData.details.show.atprd">Voir details</span>
                            <span *ngIf="character.computedData.details.show.atprd">Cacher details</span>
                        </button>
                    </md-card-actions>
                </md-card>
                <md-card>
                    <md-card-content>
                        <div class="stat-header">
                            <div class="stat-element-small">COU</div>
                            <div class="stat-element-small">INT</div>
                            <div class="stat-element-small">CHA</div>
                            <div class="stat-element-small">AD</div>
                            <div class="stat-element-small">FO</div>
                        </div>
                        <div class="stat-values">
                            <div class="stat-row">
                                <div class="stat-element-small">{{character.computedData.stats['COU']}}</div>
                                <div class="stat-element-small">{{character.computedData.stats['INT']}}</div>
                                <div class="stat-element-small">{{character.computedData.stats['CHA']}}</div>
                                <div class="stat-element-small">{{character.computedData.stats['AD']}}</div>
                                <div class="stat-element-small">{{character.computedData.stats['FO']}}</div>
                            </div>
                            <div class="stat-details" *ngIf="character.computedData.details.show.stat">
                                <div class="detail-row" *ngFor="let detail of character.computedData.details.stat">
                                    <div class="stat-detail-reason">
                                        {{detail.name}}
                                    </div>
                                    <div class="stat-row">
                                        <div class="stat-element-small">{{detail.data.COU}}</div>
                                        <div class="stat-element-small">{{detail.data.INT}}</div>
                                        <div class="stat-element-small">{{detail.data.CHA}}</div>
                                        <div class="stat-element-small">{{detail.data.AD}}</div>
                                        <div class="stat-element-small">{{detail.data.FO}}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                    <md-card-actions align="end">
                        <button md-button [color]="'primary'" (click)="character.computedData.details.show.stat = !character.computedData.details.show.stat">
                            <span *ngIf="!character.computedData.details.show.stat">Voir details</span>
                            <span *ngIf="character.computedData.details.show.stat">Cacher details</span>
                        </button>
                    </md-card-actions>
                </md-card>

                <md-card>
                    <md-card-content>
                        <div class="stat-header">
                            <div class="stat-element-large" *ngIf="character.job && character.job.isMagic">MagiePhys</div>
                            <div class="stat-element-large" *ngIf="character.job && character.job.isMagic">MagiePsy</div>
                            <div class="stat-element-large">RESM</div>
                        </div>
                        <div class="stat-values">
                            <div class="stat-row">
                                <div class="stat-element-large" *ngIf="character.job && character.job.isMagic">{{character.computedData.stats['MPHYS']}}</div>
                                <div class="stat-element-large" *ngIf="character.job && character.job.isMagic">{{character.computedData.stats['MPSY']}}</div>
                                <div class="stat-element-large">{{character.computedData.stats['RESM']}}</div>
                            </div>
                            <div class="stat-details" *ngIf="character.computedData.details.show.magic">
                                <div class="detail-row" *ngFor="let detail of character.computedData.details.magic">
                                    <div class="stat-detail-reason">
                                        {{detail.name}}
                                    </div>
                                    <div class="stat-row">
                                        <div class="stat-element-large" *ngIf="character.job && character.job.isMagic" [innerHTML]="detail.data.MPHYS || ''"></div>
                                        <div class="stat-element-large" *ngIf="character.job && character.job.isMagic" [innerHTML]="detail.data.MPSY || ''"></div>
                                        <div class="stat-element-large" [innerHTML]="detail.data.RESM || ''"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                    <md-card-actions align="end">
                        <button md-button [color]="'primary'" (click)="character.computedData.details.show.magic = !character.computedData.details.show.magic">
                            <span *ngIf="!character.computedData.details.show.magic">Voir details</span>
                            <span *ngIf="character.computedData.details.show.magic">Cacher details</span>
                        </button>
                    </md-card-actions>
                </md-card>

                <md-card *ngIf="character.computedData.stats['MV'] != 100
                                || character.computedData.stats['THROW_MODIFIER']
                                || character.computedData.stats['DISCRETION_MODIFIER']
                                || character.computedData.stats['DANSE_MODIFIER']
                                || character.computedData.stats['PI']">
                    <md-card-content>
                        <div class="stat-header">
                            <div class="stat-element" *ngIf="character.computedData.stats['MV'] !== 100">MV</div>
                            <div class="stat-element" *ngIf="character.computedData.stats['THROW_MODIFIER']">Lancer</div>
                            <div class="stat-element" *ngIf="character.computedData.stats['DISCRETION_MODIFIER']">Discretion</div>
                            <div class="stat-element" *ngIf="character.computedData.stats['DANSE_MODIFIER']">Danse</div>
                            <div class="stat-element" *ngIf="character.computedData.stats['PI']">PI</div>
                        </div>
                        <div class="stat-values">
                            <div class="stat-row">
                                <div class="stat-element" *ngIf="character.computedData.stats['MV'] !== 100">
                                    {{character.computedData.stats['MV']}}%
                                </div>
                                <div class="stat-element" *ngIf="character.computedData.stats['THROW_MODIFIER']">
                                    {{character.computedData.stats['THROW_MODIFIER'] | plusminus}}
                                </div>
                                <div class="stat-element" *ngIf="character.computedData.stats['DISCRETION_MODIFIER']">
                                    {{character.computedData.stats['DISCRETION_MODIFIER'] | plusminus}}
                                </div>
                                <div class="stat-element" *ngIf="character.computedData.stats['DANSE_MODIFIER']">
                                    {{character.computedData.stats['DANSE_MODIFIER'] | plusminus}}
                                </div>
                                <div class="stat-element" *ngIf="character.computedData.stats['PI']">
                                    {{character.computedData.stats['PI']}}
                                </div>
                            </div>
                            <div class="stat-details" *ngIf="character.computedData.details.show.other">
                                <div class="detail-row" *ngFor="let detail of character.computedData.details.other">
                                    <div class="stat-detail-reason">
                                        {{detail.name}}
                                    </div>
                                    <div class="stat-row">
                                        <div class="stat-element" *ngIf="character.computedData.stats['MV'] !== 100">
                                            {{detail.data.MV}}
                                        </div>
                                        <div class="stat-element" *ngIf="character.computedData.stats['THROW_MODIFIER']">
                                            {{detail.data.THROW_MODIFIER}}
                                        </div>
                                        <div class="stat-element" *ngIf="character.computedData.stats['DISCRETION_MODIFIER']">
                                            {{detail.data.DISCRETION_MODIFIER}}
                                        </div>
                                        <div class="stat-element" *ngIf="character.computedData.stats['DANSE_MODIFIER']">
                                            {{detail.data.DANSE_MODIFIER}}
                                        </div>
                                        <div class="stat-element" *ngIf="character.computedData.stats['PI']">
                                            {{detail.data.PI}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </md-card-content>
                    <md-card-actions align="end">
                        <button md-button [color]="'primary'" (click)="character.computedData.details.show.other = !character.computedData.details.show.other">
                            <span *ngIf="!character.computedData.details.show.other">Voir details</span>
                            <span *ngIf="character.computedData.details.show.other">Cacher details</span>
                        </button>
                    </md-card-actions>
                </md-card>
            </div>
            <div class="stat-tab">
                <md-card>
                    <div>
                        <strong>Compétence</strong>
                    </div>
                    <div>
                        <md-list dense>
                            <md-list-item *ngFor="let skill of character.computedData.skills" class="skill-list-item">
                                <h4 md-line>{{skill?.skillDef?.name}}</h4>
                                <span *ngIf="skill.canceled">CANCELED</span>
                                <p md-line>
                                    <span *ngFor="let from of skill.from; let lastFrom=last">{{from}}<span *ngIf="!lastFrom">, </span></span>
                                </p>
                                <button md-icon-button (click)="openSkillInfoDialog(skill.skillDef)">
                                    <md-icon>info</md-icon>
                                </button>
                            </md-list-item>
                        </md-list>
                    </div>
                </md-card>
            </div>
            <!-- End of stats tab -->
        </md-tab>
        <md-tab label="Inventaire">
            <!-- Start of inventory tab -->
            <inventory-panel [inGroupTab]="inGroupTab" [character]="character"></inventory-panel>
            <!-- End of inventory tab -->
        </md-tab>
        <md-tab label="Effet">
            <!-- Start of effects tab -->
            <effect-panel [character]="character"></effect-panel>
            <!-- End of effects tab -->
        </md-tab>
        <md-tab label="Loot">
            <!-- Start of effects tab -->
            <character-loot-panel [character]="character" [inGroupTab]="inGroupTab"></character-loot-panel>
            <!-- End of effects tab -->
        </md-tab>
        <md-tab label="Historique">
            <character-history [character]="character"></character-history>
        </md-tab>
    </md-tab-group>
</div>

<!-- Skill info dialog -->
<ng-template #skillInfoDialog="cdkPortal" cdk-portal>
    <md-card class="skill-info-dialog">

        <md-card-title *ngIf="!viewGmSkillInfo && selectedSkillInfo">{{selectedSkillInfo.name}}</md-card-title>
        <md-card-content *ngIf="!viewGmSkillInfo && selectedSkillInfo">
            {{selectedSkillInfo.playerDescription}}
        </md-card-content>
        <skill *ngIf="viewGmSkillInfo && selectedSkillInfo" [skill]="selectedSkillInfo"></skill>

        <md-card-actions align="end">
            <button *ngIf="!viewGmSkillInfo" md-button color="primary" (click)="viewGmSkillInfo = true">
                INFO GM
            </button>
            <button *ngIf="viewGmSkillInfo" md-button color="primary" (click)="viewGmSkillInfo = false">
                INFO JOUEUR
            </button>
            <button md-button color="primary" (click)="closeSkillInfoDialog()">
                FERMER
            </button>
        </md-card-actions>
    </md-card>
</ng-template>


<!-- Levelup modal -->
<ng-template #levelUpDialog="cdkPortal" cdk-portal>
    <md-card class="level-up-dialog">
        <md-card-title>
            Gain d'un niveau
        </md-card-title>
        <md-card-content class="level-up-dialog-content">
            <md-card>
                <md-card-subtitle>
                    Énergie vitale/Énergie Astrale
                </md-card-subtitle>
                <md-card-content>
                    <p>Pour chaque niveau gagné, on ajoute
                        1D{{character.origin.diceEVLevelUp}}<span *ngIf="characterHasToken('LEVELUP_DICE_EV_-1')"> -1 </span>
                        à son énergie vitale (EV)
                        <span *ngIf="character.job && character.job.isMagic">
                    <strong>OU</strong> 1D{{character.job.diceEaLevelUp}} astrale (EA)
                </span>
                    </p>

                    <div *ngIf="character.job && character.job.isMagic">
                        Je choisi d'augmenter mon:
                        <md-button-toggle-group [(ngModel)]="levelUpInfo.EVorEA">
                            <md-button-toggle value="EV">E.Vitale</md-button-toggle>
                            <md-button-toggle value="EA">E.Astrale</md-button-toggle>
                        </md-button-toggle-group>
                    </div>
                    <div>
                        <div *ngIf="levelUpInfo.EVorEA === 'EV'">
                            Augmentation de l'energie vitale (EV) de 1D{{character.origin.diceEVLevelUp}}
                        </div>
                        <div *ngIf="levelUpInfo.EVorEA === 'EA'">
                            Augmentation de l'energie astrale (EA) de 1D{{character.job.diceEaLevelUp}}
                        </div>

                        <div class="level-up-ea-ev">
                            <md-input-container align="end">
                                <input mdInput placeholder="Valeur" type="number" [(ngModel)]="levelUpInfo.EVorEAValue">
                                <md-hint align="end" *ngIf="levelUpInfo.EVorEA === 'EV'">
                                    Lancer 1D{{character.origin.diceEVLevelUp}}<span *ngIf="characterHasToken('LEVELUP_DICE_EV_-1')">-1</span>
                                </md-hint>
                                <md-hint align="end" *ngIf="levelUpInfo.EVorEA === 'EA'">
                                    Lancer 1D{{character.job.diceEaLevelUp}}
                                </md-hint>
                            </md-input-container>
                            <button md-raised-button color="primary" (click)="rollLevelUp()">LANCER DÉ</button>
                        </div>
                    </div>
                </md-card-content>
            </md-card>

            <md-card *ngIf="(levelUpInfo.targetLevelUp % 2) === 0">
                <md-card-subtitle>
                    Augmenter une caractéristique
                </md-card-subtitle>
                <md-card-content>
                    Je choisi:
                    <md-button-toggle-group [(ngModel)]="levelUpInfo.statToUp">
                        <md-button-toggle value="FO">FO</md-button-toggle>
                        <md-button-toggle value="AD">AD</md-button-toggle>
                        <md-button-toggle value="COU">COU</md-button-toggle>
                        <md-button-toggle value="INT">INT</md-button-toggle>
                    </md-button-toggle-group>
                </md-card-content>
            </md-card>
            <md-card *ngIf="(levelUpInfo.targetLevelUp % 2) === 1">
                <md-card-subtitle>
                    Augmenter Attaque ou parade
                </md-card-subtitle>
                <md-card-content>
                    Je choisi d'augmenter de 1 point:
                    <md-button-toggle-group [(ngModel)]="levelUpInfo.statToUp">
                        <md-button-toggle value="AT">AT</md-button-toggle>
                        <md-button-toggle value="PRD">PRD</md-button-toggle>
                    </md-button-toggle-group>
                </md-card-content>
            </md-card>
            <md-card *ngIf="levelUpShouldSelectSkill()">
                <md-card-subtitle>Compétence supplémentaire</md-card-subtitle>
                <md-card-content>
                    <skill-selector *ngIf="!levelUpInfo.skill"
                                    [selectedOrigin]="character.origin"
                                    [selectedJob]="character.job"
                                    [knownSkills]="character.skills"
                                    [skillCount]=1
                                    (skillsSelected)="onLevelUpSelectSkills($event)">
                    </skill-selector>
                    <p *ngIf="levelUpInfo.skill">J'apprends la compétence: {{levelUpInfo.skill.name}}</p>
                </md-card-content>
                <md-card-actions *ngIf="levelUpInfo.skill" align="end">
                    <button md-button
                            color="primary"
                            (click)="levelUpInfo.skill = null">
                        CHANGER
                    </button>
                </md-card-actions>
            </md-card>
            <md-card *ngIf="levelUpShouldSelectSpeciality()">
                <md-card-subtitle>Spécialisation supplémentaire</md-card-subtitle>
                <md-card-content>
                    <div *ngIf="!levelUpInfo.speciality">
                        <speciality-selector (specialityChange)="levelUpSelectSpeciality($event)" [knownSpecialities]="character.specialities" [specialities]="character.job.specialities"></speciality-selector>
                    </div>
                    <div *ngIf="levelUpInfo.speciality">Spécialité: {{levelUpInfo.speciality.name}}</div>
                </md-card-content>
                <md-card-actions *ngIf="levelUpInfo.speciality" align="end">
                    <button md-button
                            color="primary"
                            (click)="levelUpInfo.speciality = null">
                        CHANGER
                    </button>
                </md-card-actions>
            </md-card>
        </md-card-content>
        <md-card-actions align="end">
            <button md-button color="primary" (click)="closeLevelUpDialog()">
                ANNULER
            </button>
            <button md-button color="primary"  [disabled]="!levelUpFormReady()" (click)="levelUp()">
                VALIDER
            </button>
        </md-card-actions>
    </md-card>
</ng-template>
