<div *ngIf="character">
	<div class="row">
		<div *ngFor="let invite of character.invites">
			<div class="alert alert-info">
				<button class="glyphicon glyphicon-remove btn btn-danger pull-right" (click)="cancelInvite(invite)"></button>
				<button class="glyphicon glyphicon-ok btn btn-success pull-right" (click)="acceptInvite(invite)"></button>
				<strong>Invitation: </strong>
				{{invite.name}}
			</div>
		</div>
	</div>

	<ul class="nav nav-tabs" role="tablist">
		<li role="presentation" class="active">
			<a href="#tab-infos_{{character.id}}" aria-controls="tab-infos" role="tab" data-toggle="tab">
				Info
			</a>
		</li>
		<li role="presentation" class="">
			<a href="#tab-combat_{{character.id}}" aria-controls="tab-combat" role="tab" data-toggle="tab">
				Combat
			</a>
		</li>
		<li role="presentation" class="">
			<a href="#tab-statistics_{{character.id}}" aria-controls="tab-statistics" role="tab" data-toggle="tab">
				Stat
			</a>
		</li>
		<li role="presentation">
			<a href="#tab-inventory_{{character.id}}" aria-controls="tab-inventory" role="tab" data-toggle="tab">
				Inventaire
			</a>
		</li>
		<li role="presentation">
			<a href="#tab-effects_{{character.id}}" aria-controls="tab-effects" role="tab" data-toggle="tab">
				Effets
				<span class="badge">{{character.effects.length}}</span>
			</a>
		</li>
		<li role="presentation">
			<a href="#tab-other_{{character.id}}" aria-controls="tab-other" role="tab" data-toggle="tab">
				Autres
				<span class="badge">{{character.computedData.countExceptionalStats}}</span>
			</a>
		</li>
		<li role="presentation">
			<a href="#tab-history_{{character.id}}" aria-controls="tab-history" role="tab" data-toggle="tab" (click)="loadHistory()">
				Historique
			</a>
		</li>
	</ul>

	 <div class="tab-content">
		 <div role="tabpanel" class="tab-pane active" id="tab-infos_{{character.id}}">
			<!-- Start of info tab -->
		 	<div class="row">
				<div class="col-sm-6">
					<div class="row">
						<div class="col-sm-5 col-xs-5">
							<strong>Nom</strong>
						</div>
						<div class="col-sm-7 col-xs-7">{{character.name}}</div>
					</div>
					<div class="row">
						<div class="col-sm-5 col-xs-5">
							<strong>Origine</strong>
						</div>
						<div class="col-sm-7 col-xs-7">{{character.origin.name}}</div>
					</div>
					<div class="row" *ngIf="character.job">
						<div class="col-sm-5 col-xs-5">
							<strong>Métier</strong>
						</div>
						<div class="col-sm-7 col-xs-7">{{character.job.name}}</div>
					</div>
					<div *ngIf="character.specialities.length" class="row">
						<div class="col-sm-5 col-xs-4">
							<strong>Specialité</strong>
						</div>
						<div class="col-sm-7 col-xs-8">
							<ul>
								<li *ngFor="let speciality of character.specialities">{{speciality.name}}</li>
							</ul>
						</div>
					</div>
					<div class="row" *ngIf="character.group">
						<div class="col-sm-5 col-xs-5">
							<strong>Groupe</strong>
						</div>
						<div class="col-sm-7 col-xs-7">{{character.group.name}}</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="row">
						<div class="col-sm-5 col-xs-5">
							<strong>Sexe</strong>
						</div>
						<div class="col-sm-2 col-xs-2">{{character.sex}}</div>
					</div>
					<div class="row">
						<div class="col-sm-5 col-xs-5">
							<strong>Point de destins</strong>
						</div>
						<div class="col-sm-5 col-xs-5">
                            <value-editor [value]=character.fatePoint (onChange)="changeCharacterStat('fatePoint', $event)"></value-editor>
                        </div>
					</div>
					<div class="row">
						<div class="col-sm-5 col-xs-5">
							<strong>Niveau</strong>
						</div>
						<div class="col-sm-2 col-xs-2">{{character.level}}</div>
						<div class="col-sm-1 col-xs-1">
							<button *ngIf="canLevelUp()" (click)="initLevelUp()" type="button" class="btn btn-success btn-xs" data-toggle="modal" data-target="#modalLevelUp">
								<span class="glyphicon glyphicon-exclamation-sign"></span> Ding !
							</button>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-5 col-xs-5">
							<strong>Experience</strong>
						</div>
						<div class="col-sm-2 col-xs-2">
                            <value-editor [value]=character.experience (onChange)="changeCharacterStat('experience', $event)"></value-editor>
                        </div>
					</div>
                    <div *ngIf="inGroupTab" class="row">
                        <div class="col-sm-5 col-xs-5">
                            <strong>Debilibeuk</strong>
                        </div>
                        <div class="col-sm-5 col-xs-5">
                            <value-editor [value]=character.gmData.debilibeuk (onChange)="changeGmData('debilibeuk', $event)"></value-editor>
                        </div>
                    </div>
                    <div *ngIf="inGroupTab" class="row">
                        <div class="col-sm-5 col-xs-5">
                            <strong>Mankdebol</strong>
                        </div>
                        <div class="col-sm-5 col-xs-5">
                            <value-editor [value]=character.gmData.mankdebol (onChange)="changeGmData('mankdebol', $event)"></value-editor>
                        </div>
                    </div>
				</div>
			</div>
			<!-- End of infos tab -->
		 </div>

		 <div role="tabpanel" class="tab-pane" id="tab-combat_{{character.id}}">
			<!-- Start of combat tab -->
			<div class="row" style="font-size: medium;">
				<div class="col-xs-6">
                    <div [class.bg-danger]="character.ev > character.computedData.stats.EV" style="text-align: center">
                        <span class="glyphicon glyphicon-heart text-danger" style="font-size: 1.3em;"></span>
                        <value-editor [value]="character.ev" [maxValue]="character.computedData.stats.EV" (onChange)="changeCharacterStat('ev', $event)"></value-editor>
                    </div>
				</div>
				<div class="col-xs-6">
					<div *ngIf="character.ea != null">
						<div [class.bg-danger]="character.ea > character.computedData.stats.EA" style="text-align: center">
							<span class="glyphicon glyphicon-star text-info" style="font-size: 1.3em;"></span>
                            <value-editor [value]="character.ea" [maxValue]="character.computedData.stats.EA" (onChange)="changeCharacterStat('ea', $event)"></value-editor>
						</div>
					</div>
				</div>
				<table class="table table-striped table-condensed text-center">
					<tbody>
						<tr>
							<td><span class="ra ra-sword ra-2x"></span><span style="font-size: larger;">{{character.computedData.stats.AT}}</span></td>
							<td><span class="ra ra-shield ra-2x"></span><span style="font-size: larger;">{{character.computedData.stats.PRD}}</span></td>
						</tr>
						<tr>
							<td><span class="ra ra-vest ra-2x"></span><span style="font-size: larger;">{{character.computedData.stats.PR}}</span></td>
							<td><span class="ra ra-aura ra-2x"></span><span style="font-size: larger;">{{character.computedData.stats.PR_MAGIC}}</span></td>
						</tr>
					</tbody>
				</table>

				<table class="table table-striped table-condensed text-center">
					<tbody>
						<tr>
							<td class="col-xs-3"><strong>COU</strong></td>
							<td class="col-xs-3">{{character.computedData.stats.COU}}</td>
							<td class="col-xs-3"><strong>FO</strong></td>
							<td class="col-xs-3">{{character.computedData.stats.FO}}</td>
						</tr>
						<tr>
							<td><strong>AD</strong></td>
							<td>{{character.computedData.stats.AD}}</td>
							<td><strong>CHA</strong></td>
							<td>{{character.computedData.stats.CHA}}</td>
						</tr>
						<tr>
							<td><strong>PI Bonus</strong></td>
							<td>{{character.computedData.stats.PI}}</td>
						</tr>
					</tbody>
				</table>
				<table class="table table-striped table-condensed text-center">
					<tbody>
						<tr>
							<td class="col-xs-3"><strong>RESM</strong></td>
							<td class="col-xs-3">{{character.computedData.stats.RESM}}</td>
							<td class="col-xs-3"><strong>INT</strong></td>
							<td class="col-xs-3">{{character.computedData.stats.INT}}</td>
						</tr>
						<tr *ngIf="character.job && character.job.isMagic">
							<td><strong>MPHYS</strong></td>
							<td>{{character.computedData.stats.MPHYS}}</td>
							<td><strong>MPSY</strong></td>
							<td>{{character.computedData.stats.MPSY}}</td>
						</tr>
					</tbody>
				</table>

				<h3>Armes</h3>
				<div class="col-sm-6">
					<div class="list-group" *ngIf="character.computedData.itemsBySlotsAll[1]">
						<template ngFor let-item [ngForOf]="character.computedData.itemsBySlotsAll[1]" let-i="index" let-last="last">
						<button type="button" class="list-group-item btn btn-default" (click)="selectItem(item)" [class.btn-primary]="selectedItem && selectedItem.id == item.id"
							[class.active]="selectedItem && selectedItem.id == item.id">
							<span *ngIf="item.data.equiped != null" class="glyphicon glyphicon-ok"></span> {{item.data.name}}
						</button>
						</template>
					</div>
				</div>
				<div class="col-sm-6" *ngIf="selectedItem">
					<div class="bg-info">
						<item-detail [gmView]="inGroupTab" [character]="character" [item]="selectedItem" [characterStats]="stats" (itemAction)="itemAction($event, selectedItem)"></item-detail>
					</div>
				</div>
			</div>
			<!-- End of combat tab -->
		 </div>
		 <div role="tabpanel" class="tab-pane" id="tab-statistics_{{character.id}}">
			<!-- Start of stats tab -->
			<div class="row">
				<div class="col-md-3 col-sm-6">
					<table class="table table-striped table-condensed text-center">
						<thead>
							<tr>
								<th class="text-center">EV</th>
								<th *ngIf="character.job && character.job.isMagic" class="text-center">EA</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>{{character.computedData.stats.EV}}</td>
								<td>{{character.computedData.stats.EA}}</td>
							</tr>
							<template [ngIf]="character.computedData.details.show.evea">
								<template ngFor let-detail [ngForOf]="character.computedData.details.evea">
									<tr class="stats-detail-name small">
										<td colspan="15"class="text-left">{{detail.name}}:</td>
									</tr>
									<tr class="stats-detail-values"></tr>
									<tr class="stats-detail-values small">
										<td>{{detail.data.EV}}</td>
										<td>{{detail.data.EA}}</td>
									</tr>
								</template>
							</template>
							<tr (click)="character.computedData.details.show.evea = !character.computedData.details.show.evea">
								<td colspan=15 class="small" *ngIf="!character.computedData.details.show.evea">Voir details</td>
								<td colspan=15 class="small" *ngIf="character.computedData.details.show.evea">Cacher details</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="col-md-3 col-sm-6">
					<table class="table table-striped table-condensed text-center table-stats">
						<thead>
							<tr>
								<th class="text-center">AT</th>
								<th class="text-center">PRD</th>
								<th class="text-center">PR</th>
								<th *ngIf="character.computedData.stats.PR_MAGIC" class="col-xs-1 text-center">PR_MAGIC</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>{{character.computedData.stats.AT}}</td>
								<td>{{character.computedData.stats.PRD}}</td>
								<td>{{character.computedData.stats.PR}}</td>
								<td *ngIf="character.computedData.stats.PR_MAGIC">{{character.computedData.stats.PR_MAGIC}}</td>
							</tr>
							<template [ngIf]="character.computedData.details.show.atprd">
								<template ngFor let-detail [ngForOf]="character.computedData.details.atprd">
									<tr class="stats-detail-name small">
										<td colspan="15"class="text-left">{{detail.name}}:</td>
									</tr>
									<tr class="stats-detail-values"></tr>
									<tr class="stats-detail-values small">
										<td>{{detail.data.AT}}</td>
										<td>{{detail.data.PRD}}</td>
										<td>{{detail.data.PR}}</td>
										<td *ngIf="character.computedData.stats.PR_MAGIC">{{detail.data.PR_MAGIC}}</td>
									</tr>
								</template>
							</template>
							<tr (click)="character.computedData.details.show.atprd = !character.computedData.details.show.atprd">
								<td colspan=15 class="small" *ngIf="!character.computedData.details.show.atprd">Voir details</td>
								<td colspan=15 class="small" *ngIf="character.computedData.details.show.atprd">Cacher details</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="col-md-6 col-sm-12">
					<table class="table table-striped table-condensed text-center">
						<thead>
							<tr>
								<th class="text-center">COU</th>
								<th class="text-center">INT</th>
								<th class="text-center">CHA</th>
								<th class="text-center">AD</th>
								<th class="text-center">FO</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>{{character.computedData.stats.COU}}</td>
								<td>{{character.computedData.stats.INT}}</td>
								<td>{{character.computedData.stats.CHA}}</td>
								<td>{{character.computedData.stats.AD}}</td>
								<td>{{character.computedData.stats.FO}}</td>
							</tr>
							<template [ngIf]="character.computedData.details.show.stat">
								<template ngFor let-detail [ngForOf]="character.computedData.details.stat">
									<tr class="stats-detail-name small">
										<td colspan="15"class="text-left">{{detail.name}}:</td>
									</tr>
									<tr class="stats-detail-values"></tr>
									<tr class="stats-detail-values small">
										<td>{{detail.data.COU}}</td>
										<td>{{detail.data.INT}}</td>
										<td>{{detail.data.CHA}}</td>
										<td>{{detail.data.AD}}</td>
										<td>{{detail.data.FO}}</td>
									</tr>
								</template>
							</template>
							<tr (click)="character.computedData.details.show.stat = !character.computedData.details.show.stat">
								<td colspan=15 class="small" *ngIf="!character.computedData.details.show.stat">Voir details</td>
								<td colspan=15 class="small" *ngIf="character.computedData.details.show.stat">Cacher details</td>
							</tr>
						</tbody>
					</table>
				</div>

			</div>
			<div class="row">
				<div class="col-sm-7 col-md-8">
					<table class="table table-striped table-condensed text-center">
						<thead>
							<tr>
								<th class="text-center" *ngIf="character.job && character.job.isMagic"><strong>MagiePhys</strong></th>
								<th class="text-center" *ngIf="character.job && character.job.isMagic"><strong>MagiePsy</strong></th>
								<th class="text-center"><strong>ResMagie</strong></th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td *ngIf="character.job && character.job.isMagic">{{character.computedData.stats.MPHYS}}</td>
								<td *ngIf="character.job && character.job.isMagic">{{character.computedData.stats.MPSY}}</td>
								<td>{{character.computedData.stats.RESM}}</td>
							</tr>
							<template [ngIf]="character.computedData.details.show.magic">
								<template ngFor let-detail [ngForOf]="character.computedData.details.magic">
									<tr class="stats-detail-name small">
										<td colspan="15"class="text-left">{{detail.name}}:</td>
									</tr>
									<tr class="stats-detail-values"></tr>
									<tr class="stats-detail-values small">
										<td *ngIf="character.job && character.job.isMagic" [innerHTML]="detail.data.MPHYS || ''"></td>
										<td *ngIf="character.job && character.job.isMagic" [innerHTML]="detail.data.MPSY || ''"></td>
										<td [innerHTML]="detail.data.RESM || ''"></td>
									</tr>
								</template>
							</template>
							<tr (click)="character.computedData.details.show.magic = !character.computedData.details.show.magic">
								<td colspan=15 class="small" *ngIf="!character.computedData.details.show.magic">Voir details</td>
								<td colspan=15 class="small" *ngIf="character.computedData.details.show.magic">Cacher details</td>
							</tr>
						</tbody>
					</table>
					<table *ngIf="character.computedData.stats.MV != 100 || character.computedData.stats.THROW_MODIFIER  || character.computedData.stats.DISCRETION_MODIFIER  || character.computedData.stats.DANSE_MODIFIER || character.computedData.stats.PI" class="table table-striped table-condensed text-center">
						<thead>
							<tr>
								<th *ngIf="character.computedData.stats.MV != 100" class="text-center"><strong>MV</strong></th>
								<th *ngIf="character.computedData.stats.THROW_MODIFIER" class="text-center"><strong>Lancer</strong></th>
								<th *ngIf="character.computedData.stats.DISCRETION_MODIFIER" class="text-center"><strong>Discretion</strong></th>
								<th *ngIf="character.computedData.stats.DANSE_MODIFIER" class="text-center"><strong>Danse</strong></th>
								<th *ngIf="character.computedData.stats.PI" class="text-center"><strong>PI</strong></th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td *ngIf="character.computedData.stats.MV != 100">{{character.computedData.stats.MV}}%</td>
								<td *ngIf="character.computedData.stats.THROW_MODIFIER">{{character.computedData.stats.THROW_MODIFIER | plusminus}}</td>
								<td *ngIf="character.computedData.stats.DISCRETION_MODIFIER">{{character.computedData.stats.DISCRETION_MODIFIER | plusminus}}</td>
								<td *ngIf="character.computedData.stats.DANSE_MODIFIER">{{character.computedData.stats.DANSE_MODIFIER | plusminus}}</td>
								<td *ngIf="character.computedData.stats.PI">{{character.computedData.stats.PI}}</td>
							</tr>
							<template [ngIf]="character.computedData.details.show.other">
								<template ngFor let-detail [ngForOf]="character.computedData.details.other">
									<tr class="stats-detail-name small">
										<td colspan="15"class="text-left">{{detail.name}}:</td>
									</tr>
									<tr class="stats-detail-values"></tr>
									<tr class="stats-detail-values small">
										<td *ngIf="character.computedData.stats.MV != 100">{{detail.data.MV}}</td>
										<td *ngIf="character.computedData.stats.THROW_MODIFIER">{{detail.data.THROW_MODIFIER}}</td>
										<td *ngIf="character.computedData.stats.DISCRETION_MODIFIER">{{detail.data.DISCRETION_MODIFIER}}</td>
										<td *ngIf="character.computedData.stats.DANSE_MODIFIER">{{detail.data.DANSE_MODIFIER}}</td>
										<td *ngIf="character.computedData.stats.PI">{{detail.data.PI}}</td>
									</tr>
								</template>
							</template>
							<tr (click)="character.computedData.details.show.other = !character.computedData.details.show.other">
								<td colspan=15 class="small" *ngIf="!character.computedData.details.show.other">Voir details</td>
								<td colspan=15 class="small" *ngIf="character.computedData.details.show.other">Cacher details</td>
							</tr>
						</tbody>
					</table>
				</div>
				<hr class="visible-xs">
				<div class="col-md-4 col-sm-5">
					<div>
						<strong>Compétence</strong>
					</div>
					<div>
						<ul>
							<li *ngFor="let skill of character.computedData.skills">
								<span [class.canceled]="skill.canceled">{{skill?.skillDef?.name}}</span> (<span *ngFor="let from of skill.from; let lastFrom=last">{{from}}<span *ngIf="!lastFrom">, </span></span>)
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!-- End of stats tab -->
		 </div>
		 <div role="tabpanel" class="tab-pane" id="tab-inventory_{{character.id}}">
			<!-- Start of inventory tab -->
			<div class="row" style="min-height: 350px">
				<div class="col-sm-6">
					<div class="row-fluid">
						<ul class="nav nav-pills">
							<li role="presentation" [class.active]="selectedInventoryTab=='all'"><a (click)="selectedInventoryTab = 'all'">Tout</a></li>
							<li role="presentation" [class.active]="selectedInventoryTab=='bags'"><a (click)="selectedInventoryTab = 'bags'">Sacs</a></li>
							<li role="presentation" [class.active]="selectedInventoryTab=='equiped'"><a (click)="selectedInventoryTab = 'equiped'">Equipé</a></li>
							<li role="presentation" [class.active]="selectedInventoryTab=='add'"><a (click)="selectedInventoryTab = 'add';updateFilterItem()" class="glyphicon glyphicon-plus"></a></li>
						</ul>
					</div>
					<div class="row-fluid">
						<div class="form-group">
							<input class="form-control" (keydown.esc)="itemFilterName=null" [(ngModel)]="itemFilterName" (ngModelChange)="updateFilterItem()" placeholder="filter"/>
						</div>
					</div>
					<div *ngIf="selectedInventoryTab=='all'" class="row">
						<div class="col-sm-12">
							<div class="list-group" style="height:300px; overflow-y: auto">
								<a href="#" *ngFor="let item of character.items" class="list-group-item" (click)="selectItem(item)" [class.active]="selectedItem && selectedItem.id == item.id" [class.hidden]="!isItemFilteredByName(item)">
									<span *ngIf="item.data.equiped != null" class="glyphicon glyphicon-ok"></span>
									<span *ngIf="item.data.equiped == null && !item.container" class="glyphicon glyphicon-exclamation-sign"></span>
									<span *ngIf="item.data.quantity">{{item.data.quantity}}</span>
									{{item.data.name}}
								</a>
							</div>
						</div>
					</div>
					<div *ngIf="selectedInventoryTab=='bags'" class="row">
						<div class="col-sm-12" *ngIf="character.computedData.topLevelContainers">
							<div class="list-group" style="height:300px; overflow-y: auto">
								<bag-item-view [items]="character.computedData.topLevelContainers" [selectedItem]="selectedItem" (itemSelected)="selectItem($event)">Loading</bag-item-view>
							</div>
						</div>
					</div>
					<div *ngIf="selectedInventoryTab=='add'" class="row-fluid">
						<div class="list-group" *ngIf="!selectedAddItem">
							<a href="#" *ngFor="let item of filteredItems" (click)="selectAddItem(item)" [class.active]="isAddItemSelected(item)" class="list-group-item"> {{item.name}} </a>
						</div>

						<div *ngIf="selectedAddItem">
							<div class="row-fluid">
								<div class="list-group">
									<a href="#" (click)="unselectAddItem()" class="list-group-item active">
										<span class="glyphicon glyphicon-remove"></span> {{selectedAddItem.name}}
									</a>
								</div>
							</div>
							<div class="row">
								<div class="col-sm-2">
									<span>Nom: </span>
								</div>
								<div class="col-sm-10">
									<input class="form-control" type="text" [(ngModel)]="itemAddCustomName" />
								</div>
							</div>
							<div class="row">
								<div class="col-sm-2">
									<span>Description: </span>
								</div>
								<div class="col-sm-10">
									<input class="form-control" type="text" [(ngModel)]="itemAddCustomDescription" />
								</div>
							</div>
							<div class="row" *ngIf="selectedAddItem.data.quantifiable">
								<div class="col-sm-2">
									<span>Quantité: </span>
								</div>
								<div class="col-sm-10">
									<input class="form-control" type="text" [(ngModel)]="itemAddQuantity" />
								</div>
							</div>
							<div>
								<button (click)="addItem()" type="button" class="btn btn-primary" data-dismiss="modal">Ajouter</button>
							</div>
						</div>
					</div>

					<div class="row-fluid" *ngIf="selectedInventoryTab=='equiped'" >
						<div *ngFor="let slot of character.computedData.itemSlots">
							{{slot.name}}:
							<div class="list-group">
								<template ngFor let-item [ngForOf]="character.computedData.itemsBySlots[slot.id]" let-i="index" let-last="last">
								<div class="row">
									<div class="btn-group col-xs-12" role="group">
										<button type="button" class="btn btn-default"
											[class.col-xs-8]="character.computedData.itemsBySlots[slot.id].length > 2 && (i && !last)"
											[class.col-xs-10]="character.computedData.itemsBySlots[slot.id].length == 2 || (character.computedData.itemsBySlots[slot.id].length > 2 && (i == 0 || last))"
											[class.col-xs-12]="character.computedData.itemsBySlots[slot.id].length == 1"
											[class.col-md-10]="character.computedData.itemsBySlots[slot.id].length > 2 && (i && !last)"
											[class.col-md-11]="character.computedData.itemsBySlots[slot.id].length == 2 || (character.computedData.itemsBySlots[slot.id].length > 2 && (i == 0 || last))"
											[class.col-md-12]="character.computedData.itemsBySlots[slot.id].length == 1"
											(click)="selectItem(item)"
											[class.btn-primary]="selectedItem && selectedItem.id == item.id"
											[class.active]="selectedItem && selectedItem.id == item.id">
										<span *ngIf="item.data.quantity">{{item.data.quantity}}</span>
											{{item.data.name}}
										</button>
										<button *ngIf="i > 0 && character.computedData.itemsBySlots[slot.id].length > 1" type="button" class="btn btn-default col-md-1 col-xs-2" (click)="itemAction({action: 'equip', level: 1}, item)">
											<span style="font-family: 'Glyphicons Halflings'">&#57491;</span>
										</button>
										<button *ngIf="!last && character.computedData.itemsBySlots[slot.id].length > 1" type="button" class="btn btn-default col-md-1 col-xs-2" (click)="itemAction({action: 'equip', level: -1}, item)">
											<span style="font-family: 'Glyphicons Halflings'">&#57492;</span>
										</button>
									</div>
								</div>
								</template>
							</div>
						</div>
					</div>

				</div>

				<div class="col-sm-6" *ngIf="selectedItem">
					<div class="bg-info">
						<item-detail [gmView]="inGroupTab"  [character]="character" [item]="selectedItem" (itemAction)="itemAction($event, selectedItem)"></item-detail>
					</div>
					<div *ngIf="character.computedData.containers && !selectedItem.data.equiped">
						<template [ngIf]="selectedItem.container">
							Dans: {{selectedItem.containerInfo.name}}
							<button class="btn btn-danger"  (click)="itemAction({action: 'move_to_container', container: null}, selectedItem)">Retirer</button>
						</template>
						<template [ngIf]="!selectedItem.container">
							<h4>Ranger dans</h4>
							<div class="list-group">
								<template ngFor let-item [ngForOf]="character.computedData.containers" let-i="index" let-last="last">
									<a href="#" class="list-group-item" (click)="itemAction({action: 'move_to_container', container: item.id}, selectedItem)">
										{{item.data.name}}
									</a>
								</template>
							</div>
						</template>
					</div>
				</div>


			</div>
			<!-- End of inventory tab -->
		 </div>
		 <div role="tabpanel" class="tab-pane" id="tab-effects_{{character.id}}">
			<!-- Start of effects tab -->
			<div class="row">
				<div class="col-sm-6">
					<div class="list-group">
						<template ngFor let-effect [ngForOf]="character.effects" let-i="index" let-last="last">
							<button (click)="selectEffect(effect)" type="button" class="list-group-item">
								{{effect.name}}
							</button>
						</template>
						<template ngFor let-modifier [ngForOf]="character.modifiers" let-i="index" let-last="last">
							<button *ngIf="!modifier.permanent" (click)="selectModifier(modifier)" type="button" class="list-group-item">
								{{modifier.name}}
							</button>
						</template>
						<button (click)="selectEffect(effect)" type="button" class="list-group-item" data-toggle="modal" data-target="#modalAddEffect">
							<span class="glyphicon glyphicon-plus"></span>
						</button>
					</div>
				</div>
				<div class="col-sm-6 bg-info">
					<div *ngIf="selectedEffect">
						<button type="button" class="glyphicon glyphicon-trash btn btn-danger pull-right" (click)="removeEffect(selectedEffect)"></button>
						<h4>{{selectedEffect.name}}
							<span class="label label-default">{{selectedEffect.category.name}}</span>
						</h4>
						<p>{{selectedEffect.description}}</p>
						<p *ngIf="selectedEffect.duration">Durée: {{selectedEffect.duration}}</p>
						<div *ngFor="let modifier of selectedEffect.modifiers">
							{{modifier | modifier}}
						</div>
					</div>
					<div *ngIf="selectedModifier">
						<button type="button" class="glyphicon glyphicon-trash btn btn-danger pull-right" (click)="removeModifier(selectedModifier)"></button>
						<h4>{{selectedModifier.name}}</h4>
						<p *ngIf="selectedModifier.duration">Durée: {{selectedModifier.duration}}</p>
						<div *ngFor="let modifier of selectedModifier.values">
							{{modifier | modifier}}
						</div>
					</div>
				</div>
			</div>
			<!-- End of effects tab -->
		 </div>
		 <div role="tabpanel" class="tab-pane" id="tab-other_{{character.id}}">
			<!-- Start of other tab -->
			<div *ngIf="character.computedData.stats['AD'] > 12" class="row">
				<div class="col-xs-7 col-sm-5 col-md-3 col-lg-2">
					<strong>Bonus AD</strong>
				</div>
				<div class="col-xs-5">
					<div class="btn-group" data-toggle="buttons">
						<button class="btn btn-primary" (click)="setStatBonusAD(character.id, 'AT')" [class.active]="character.statBonusAD == 'AT'">AT</button>
						<button class="btn btn-primary" (click)="setStatBonusAD(character.id, 'PRD')" [class.active]="character.statBonusAD == 'PRD'">PRD</button>
					</div>
				</div>
			</div>

			<div *ngIf="character.computedData.stats['AD'] < 9" class="row">
				<div class="col-xs-7 col-sm-5 col-md-3 col-lg-2">
					<strong>Malus AD</strong>
				</div>
				<div class="col-xs-5">
					<div class="btn-group" data-toggle="buttons">
						<button class="btn btn-primary" (click)="setStatBonusAD(character.id, 'AT')" [class.active]="character.statBonusAD == 'AT'">AT</button>
						<button class="btn btn-primary" (click)="setStatBonusAD(character.id, 'PRD')" [class.active]="character.statBonusAD == 'PRD'">PRD</button>
					</div>
				</div>
			</div>
			<div *ngIf="character.computedData.stats['INT'] > 12" class="row">
				<div class="col-xs-7 col-sm-5 col-md-3 col-lg-2">
					<strong>Bonus Degat magique</strong>
				</div>
				<div class="col-xs-5">{{(character.computedData.stats['INT'] - 12)}}</div>
			</div>
			<!-- End of other tab -->
		 </div>
		 <div role="tabpanel" class="tab-pane" id="tab-history_{{character.id}}">
			<div *ngFor="let loggroup of history">
				{{loggroup.date | date:'mediumDate'}}
				<div style="padding-bottom: 5px; margin-left: 10px; padding-left: 10px; padding-top: 5px; border-left: 1px solid #E2D7D7">
				<div *ngFor="let log of loggroup.logs" [class.bg-success]=log.isGroup>
					{{log.date | date:'shortTime'}}:
					<template [ngIf]="log.isGroup">
					<span [ngSwitch]="log.action">
						<template [ngSwitchCase]="'EVENT_RP'">
							{{log.info}}
						</template>
                        <template [ngSwitchCase]="'MANKDEBOL'">
							Mankdebol: {{log.data.oldValue}} -> {{log.data.newValue}}
						</template>
						<template [ngSwitchCase]="'DEBILIBEUK'">
							Debilibeuk: {{log.data.oldValue}} -> {{log.data.newValue}}
						</template>
						<template ngSwitchDefault>{{log.action}}: {{log.info}}</template>
					</span>
					</template>
					<template [ngIf]="!log.isGroup">
					<span [ngSwitch]="log.action">
						<template [ngSwitchCase]="'EQUIP'">
							Equipe: {{log.item.data.name}}
						</template>
						<template [ngSwitchCase]="'UNEQUIP'">
							Désquipe: {{log.item.data.name}}
						</template>
						<template [ngSwitchCase]="'ADD_ITEM'">
							Ajout de l'objet: {{log.item.data.name}}
						</template>
						<template [ngSwitchCase]="'READ_BOOK'">
							Lecture du livre: {{log.item.data.name}}
						</template>
						<template [ngSwitchCase]="'DELETE_ITEM'">
							Suppression de l'objet: {{log.item.data.name}}
						</template>
						<template [ngSwitchCase]="'APPLY_EFFECT'">
							Ajout de l'effet: {{log.effect.name}}
						</template>
						<template [ngSwitchCase]="'APPLY_MODIFIER'">
							Ajout du modificateur: {{log.modifier.name}}
						</template>
						<template [ngSwitchCase]="'REMOVE_MODIFIER'">
							Suppression du modificateur: {{log.modifier.name}}
						</template>
						<template [ngSwitchCase]="'CHANGE_QUANTITY'">
							Modification quantité: {{log.item.data.name}} {{log.data.oldValue}} -> {{log.data.newValue}}
  						</template>
						<template [ngSwitchCase]="'USE_CHARGE'">
							Utilisation de charge: {{log.item.data.name}} {{log.info}}
						</template>
						<template [ngSwitchCase]="'REMOVE_EFFECT'">
							Suppression de l'effet: {{log.effect.name}}
						</template>
						<template [ngSwitchCase]="'ADD_XP'">
							Ajout d'experience: {{log.info}}
						</template>
						<template [ngSwitchCase]="'LEVEL_UP'">
							Level Up: {{log.info}}
						</template>
						<template [ngSwitchCase]="'USE_FATE_POINT'">
							Utilisation d'un point de destin
						</template>
						<template [ngSwitchCase]="'MODIFY_EV'">
							Modification EV: {{log.data.oldValue}} -> {{log.data.newValue}}
						</template>
						<template [ngSwitchCase]="'MODIFY_EA'">
							Modification EA: {{log.data.oldValue}} -> {{log.data.newValue}}
						</template>
						<template [ngSwitchCase]="'MANKDEBOL'">
							Mankdebol: {{log.data.oldValue}} -> {{log.data.newValue}}
						</template>
						<template [ngSwitchCase]="'DEBILIBEUK'">
							Debilibeuk: {{log.data.oldValue}} -> {{log.data.newValue}}
						</template>
						<template ngSwitchDefault>{{log.action}}</template>
					</span>
					</template>
				</div>
				</div>
			</div>
			<div *ngIf="loadMore">
				<a href="#" (click)="loadHistory(1)">Charger plus</a>
			</div>
		 </div>
	 </div>

	<div>

		<!-- Effect modal -->
		<div class="modal fade" id="modalAddEffect" tabindex="-1" role="dialog" aria-labelledby="modalAddEffectLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="modalAddEffectLabel">Ajouter un effet</h4>
					</div>
					<div class="modal-body">
						<ul class="nav nav-tabs" role="tablist">
							<li role="presentation" class="active"><a href="#tab-addeffect-predefined" aria-controls="tab-addeffect-predefined" role="tab" data-toggle="tab">Prédéfini</a></li>
							<li role="presentation"><a href="#tab-addeffect-custom" aria-controls="tab-addeffect-custom" role="tab" data-toggle="tab">Custom</a></li>
						</ul>
						<div class="tab-content">
							<div role="tabpanel" class="tab-pane active" id="tab-addeffect-predefined">
								<div class="row">
									<label class="col-sm-2 control-label">Effet</label>
									<div class="col-sm-10">
										<input class="form-control" type="text" [(ngModel)]="effectFilterName" (ngModelChange)="updateFilterEffect()" />
									</div>
								</div>
								<div *ngIf="filteredEffects" class="list-group">
									<button *ngFor="let effect of filteredEffects" type="button" class="list-group-item" (click)="addEffect(effect)" data-dismiss="modal">{{effectCategoriesById[effect.category].name}}: {{effect.name}}</button>
								</div>
							</div>
							<div role="tabpanel" class="tab-pane" id="tab-addeffect-custom">
								<div class="form-group row">
									<label class="col-sm-2 control-label">Nom</label>
									<div class="col-sm-10">
										<input class="form-control" type="text" [(ngModel)]="customAddModifier.name" />
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-2 control-label">Durée</label>
									<div class="col-sm-10">
										<input class="form-control" type="text" [(ngModel)]="customAddModifier.duration" />
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-2 control-label">Modificateur</label>
									<div class="col-sm-10">
										<modifiers-editor [(modifiers)]="customAddModifier.values"></modifiers-editor>
									</div>
								</div>
								<button type="button" class="btn btn-primary" (click)="addCustomModifier()" data-dismiss="modal">Ajouter</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Levelup modal -->
	<div *ngIf="canLevelUp()">

		<!-- Modal -->
		<div class="modal fade" id="modalLevelUp" tabindex="-1" role="dialog" aria-labelledby="modalLevelUpLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="modalLevelUpLabel">Gain d'un niveau</h4>
					</div>
					<div class="modal-body">
						<div *ngIf="character.job && character.job.isMagic">
							Augmenter:
							<div class="btn-group" data-toggle="buttons">
								<button class="btn btn-primary" (click)="levelUpInfo.EVorEA = 'EV'" [class.active]="levelUpInfo.EVorEA == 'EV'">EV</button>
								<button class="btn btn-primary" (click)="levelUpInfo.EVorEA = 'EA'" [class.active]="levelUpInfo.EVorEA == 'EA'">EA</button>
							</div>
							<div></div>
						</div>
						<div>
							Augmentation de {{levelUpInfo.EVorEA}} de <span *ngIf="levelUpInfo.EVorEA == 'EV'">1d{{character.origin.diceEVLevelUp}} <span *ngIf="characterHasToken('LEVELUP_DICE_EV_-1')"> -1 </span>
							</span>
							<div>
								<span *ngIf="levelUpInfo.EVorEA == 'EA'">1d{{character.job.diceEaLevelUp}}</span> Nombre de {{levelUpInfo.EVorEA}} a augmente: <input [(ngModel)]="levelUpInfo.EVorEAValue" type="number" />
								<button class="btn btn-primary" (click)="rollLevelUp()">Roll</button>
							</div>
						</div>
						<div *ngIf="(levelUpInfo.targetLevelUp % 2) == 0">
							<div class="btn-group" data-toggle="buttons">
								<button class="btn btn-primary" (click)="setLevelUpStatToUp('FO')" [class.active]="levelUpInfo.statToUp == 'FO'">FORCE</button>
								<button class="btn btn-primary" (click)="setLevelUpStatToUp('AD')" [class.active]="levelUpInfo.statToUp == 'AD'">ADRESSE</button>
								<button class="btn btn-primary" (click)="setLevelUpStatToUp('COU')" [class.active]="levelUpInfo.statToUp == 'COU'">COURAGE</button>
								<button class="btn btn-primary" (click)="setLevelUpStatToUp('INT')" [class.active]="levelUpInfo.statToUp == 'INT'">INTELLIGENCE</button>
							</div>
						</div>
						<div *ngIf="(levelUpInfo.targetLevelUp % 2) == 1">
							<div class="btn-group" data-toggle="buttons">
								<button class="btn btn-primary" (click)="setLevelUpStatToUp('AT')" [class.active]="levelUpInfo.statToUp == 'AT'">AT</button>
								<button class="btn btn-primary" (click)="setLevelUpStatToUp('PRD')" [class.active]="levelUpInfo.statToUp == 'PRD'">PRD</button>
							</div>
						</div>
						<div *ngIf="levelUpShouldSelectSkill()">
							<skill-selector [selectedOrigin]="character.origin" [selectedJob]="character.job" [knownSkills]="character.skills" [skillCount]=1 (skillsSelected)="onLevelUpSelectSkills($event)"></skill-selector>
						</div>
						<div *ngIf="levelUpShouldSelectSpeciality()">
							<div *ngIf="!levelUpInfo.speciality">
								<speciality-selector (specialityChange)="levelUpSelectSpeciality($event)" [knownSpecialities]="character.specialities" [specialities]="character.job.specialities"></speciality-selector>
							</div>
							<div *ngIf="levelUpInfo.speciality">Specialité: {{levelUpInfo.speciality.name}}</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						<button [disabled]="!levelUpFormReady()" (click)="levelUp()" type="button" class="btn btn-primary" data-dismiss="modal">Save changes</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
