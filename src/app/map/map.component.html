<mat-sidenav-container [hasBackdrop]="isMobile || (!selectedMarker || !selectedMarker.editable)">
    <mat-sidenav-content>
        <div #mapElement class="map">
        </div>
    </mat-sidenav-content>
    <mat-sidenav #menuSidenav mode="over" position="start" class="menu-panel" [autoFocus]="false">
        <div class="panel">
            <div class="map-config side-panel-block">
                <h2 class="mat-h2 header">
                    Informations
                </h2>
                <div>
                    {{map?.name}}
                </div>
                <div class="unit">
                    <span>Échelle: {{map?.data.pixelPerUnit}} pixels / {{map?.data.unitName}}</span>
                </div>
            </div>
            <div class="grid-config side-panel-block">
                <h2 class="mat-h2">Grille</h2>
                <div class="toggle-size">
                    <mat-checkbox [ngModel]="gridDisplayed" (change)="toggleGrid($event.checked)">Activé</mat-checkbox>
                    <mat-form-field>
                        <input matInput
                               placeholder="Espacement"
                               (ngModelChange)="changeGridSize($event)"
                               [(ngModel)]="gridSize"
                               type="number"
                               autocomplete="off"
                               autocapitalize="off"/>
                    </mat-form-field>
                </div>
                <div class="offset">
                    <mat-form-field>
                        <input matInput
                               placeholder="Offset X"
                               [(ngModel)]="gridOffsetX"
                               (ngModelChange)="changeGridOffsetX($event)"
                               type="number"
                               step="0.1"
                               autocomplete="off"
                               autocapitalize="off"/>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput
                               placeholder="Offset Y"
                               [(ngModel)]="gridOffsetY"
                               (ngModelChange)="changeGridOffsetY($event)"
                               type="number"
                               step="0.1"
                               autocomplete="off"
                               autocapitalize="off"/>
                    </mat-form-field>
                </div>
            </div>
            <div class="markers side-panel-block" *ngIf="map">
                <h2 class="mat-h2">
                    Marqueurs
                    <button mat-icon-button [matMenuTriggerFor]="markerMenu" *ngIf="currentUser">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                </h2>
                <div *ngFor="let mapLayer of map.layers" class="layer">
                    <div class="title">
                        <button mat-icon-button
                                *ngIf="!expandedLayerList[mapLayer.id]"
                                (click)="expandMarkerList(mapLayer)">
                            <mat-icon>keyboard_arrow_right</mat-icon>
                        </button>
                        <button mat-icon-button
                                *ngIf="expandedLayerList[mapLayer.id]"
                                (click)="collapseMarkerList(mapLayer)">
                            <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                        <span class="layer-name">
                            <mat-icon *ngIf="mapLayer.source !== 'official'" matTooltip="Privé (seulement visible par vous)">lock</mat-icon>
                            {{mapLayer.name}}
                        </span>
                        <button mat-icon-button (click)="toggleVisibility(mapLayer)">
                            <mat-icon *ngIf="hiddenLayers[mapLayer.id]">visibility_off</mat-icon>
                            <mat-icon *ngIf="!hiddenLayers[mapLayer.id]">visibility_on</mat-icon>
                        </button>
                    </div>
                    <ng-template [ngIf]="expandedLayerList[mapLayer.id]">
                        <div *ngFor="let marker of mapLayer.markers" class="marker-link">
                            <a *ngIf="!hiddenLayers[mapLayer.id]" (click)="goToMarker(marker)">{{marker.name}}</a>
                            <span *ngIf="hiddenLayers[mapLayer.id]">{{marker.name}}</span>
                        </div>
                    </ng-template>
                    <button mat-stroked-button (click)="startAddMapMarker(mapLayer)" *ngIf="canEditLayer(mapLayer)">
                        <mat-icon>add</mat-icon>Marqueur
                    </button>
                </div>
            </div>
            <mat-menu #markerMenu>
                <button mat-menu-item (click)="openAddMapLayerDialog()">
                    <mat-icon>add</mat-icon>
                    Ajouter un calque
                </button>
            </mat-menu>

            <div class="login-area">
                <common-nav></common-nav>
            </div>
        </div>
    </mat-sidenav>
    <mat-sidenav #infoSidenav mode="over" position="end" class="side-panel mat-typography" [autoFocus]="false">
        <ng-template [ngIf]="selectedMarker">
            <div *ngIf="selectedMarker.editable" class="marker-editor side-panel-block">
                <div class="name" [formGroup]="markerForm">
                    <mat-form-field>
                        <input matInput formControlName="name" placeholder="Nom"/>
                    </mat-form-field>
                </div>
                <div class="description" [formGroup]="markerForm">
                    <mat-form-field>
                    <textarea cdkTextareaAutosize [cdkAutosizeMinRows]="4" [cdkAutosizeMaxRows]="10"
                              matInput formControlName="description" placeholder="Description"></textarea>
                    </mat-form-field>
                </div>
                <div class="color" *ngIf="selectedMarker.useColor()">
                    Couleur: <input type="color" [ngModel]="selectedMarker.color" (ngModelChange)="changeSelectedMarkerColor($event)">
                </div>
                <div class="actions">
                    <button mat-button color="primary" *ngIf="!selectedMarker.id" (click)="cancelEdit(selectedMarker)">SUPPRIMER</button>
                    <button mat-button color="primary" *ngIf="selectedMarker.id" (click)="cancelEdit(selectedMarker)">ANNULER</button>
                    <button mat-button color="primary" *ngIf="!selectedMarker.id" (click)="saveMarker(selectedMarker)">CRÉER</button>
                    <button mat-button color="primary" *ngIf="selectedMarker.id" (click)="saveMarker(selectedMarker)">MODIFIER</button>
                </div>
            </div>
            <div *ngIf="!selectedMarker.editable" class="marker-detail side-panel-block">
                <div>
                    <h2 class="header">
                        {{selectedMarker.name}}
                        <button mat-icon-button [matMenuTriggerFor]="currentMarkerMenu" *ngIf="canEditLayer(selectedMarker.mapLayer)">
                            <mat-icon>more_vert</mat-icon>
                        </button>
                    </h2>
                </div>
                <div>
                    {{selectedMarker.description}}
                </div>
                <mat-menu #currentMarkerMenu>
                    <button mat-menu-item (click)="startEditMarker(selectedMarker)">
                        <mat-icon>edit</mat-icon>
                        Éditer
                    </button>
                    <button mat-menu-item [matMenuTriggerFor]="confirmDeleteMarker">
                        <mat-icon>delete</mat-icon>
                        Supprimer
                    </button>
                </mat-menu>
                <mat-menu #confirmDeleteMarker>
                    <button mat-menu-item (click)="deleteMarker(selectedMarker)">
                        <mat-icon>check</mat-icon>
                        Confirmer
                    </button>
                </mat-menu>
            </div>
        </ng-template>
    </mat-sidenav>
</mat-sidenav-container>


<div class="menu-button">
    <button color="primary" mat-mini-fab (click)="menuSidenav.toggle()" *ngIf="!menuSidenav.opened">
        <mat-icon>menu</mat-icon>
    </button>
</div>

<div class="menu-grid-placement" *ngIf="gridDisplayed && !menuSidenav.opened">
    <button color="primary" mat-mini-fab (click)="startDragGrid()" *ngIf="!isGridDraggable">
        <mat-icon>control_camera</mat-icon>
    </button>
    <button color="primary" mat-mini-fab (click)="stopDragGrid()" *ngIf="isGridDraggable">
        <mat-icon>stop</mat-icon>
    </button>
</div>

