<mat-sidenav-container [hasBackdrop]="true">
    <mat-sidenav-content>
        <div #mapElement class="map">
        </div>
    </mat-sidenav-content>
    <mat-sidenav #menuSidenav mode="over" position="start" class="menu-panel">
        <div class="map-config">
            <h2 class="mat-h2">Carte</h2>
            <div class="name">
                <mat-form-field>
                    <input matInput [ngModel]="map?.name" placeholder="Nom" [disabled]="true" />
                </mat-form-field>
            </div>
            <div class="unit">
                <mat-form-field>
                    <input matInput [ngModel]="map?.data.pixelPerUnit" placeholder="Nombre de pixel par unité" [disabled]="true" />
                </mat-form-field>
                <mat-form-field>
                    <input matInput [ngModel]="map?.data.unitName" placeholder="Unité" [disabled]="true" />
                </mat-form-field>
            </div>
        </div>
        <div class="grid-config">
            <h2 class="mat-h2">Grille</h2>
            <div class="toggle-size">
                <mat-checkbox [ngModel]="gridDisplayed" (change)="toggleGrid($event.checked)">Activé</mat-checkbox>
                <mat-form-field>
                    <input matInput
                           placeholder="Espacement"
                           (ngModelChange)="changeGridSize($event)"
                           [(ngModel)]="gridSize"
                           type="number"
                           autocomplete="off"
                           autocapitalize="off"/>
                </mat-form-field>
            </div>
            <div class="offset">
                <mat-form-field>
                    <input matInput
                           placeholder="Offset X"
                           [(ngModel)]="gridOffsetX"
                           (ngModelChange)="changeGridOffsetX($event)"
                           type="number"
                           step="0.1"
                           autocomplete="off"
                           autocapitalize="off"/>
                </mat-form-field>
                <mat-form-field>
                    <input matInput
                           placeholder="Offset Y"
                           [(ngModel)]="gridOffsetY"
                           (ngModelChange)="changeGridOffsetY($event)"
                           type="number"
                           step="0.1"
                           autocomplete="off"
                           autocapitalize="off"/>
                </mat-form-field>
            </div>
        </div>
        <div class="markers" *ngIf="map">
            <h2 class="mat-h2">
                Marqueurs
                <button mat-icon-button [matMenuTriggerFor]="markerMenu">
                    <mat-icon>more_vert</mat-icon>
                </button>
            </h2>
            <div *ngFor="let mapLayer of map.layers" class="layer">
                <h3 class="mat-h3">{{mapLayer.name}}</h3>
                <button mat-stroked-button (click)="startAddMapMarker(mapLayer)">
                    <mat-icon>add</mat-icon>Marqueur
                </button>
            </div>
        </div>
        <mat-menu #markerMenu>
            <button mat-menu-item (click)="openAddMapLayerDialog()">
                <mat-icon>add</mat-icon>
                Ajouter un calque
            </button>
        </mat-menu>
    </mat-sidenav>
    <mat-sidenav #infoSidenav mode="over" position="end" class="side-panel mat-typography">
        <ng-template [ngIf]="selectedMarker">
            <div *ngIf="selectedMarker.editable" class="marker-editor">
                <div class="name" [formGroup]="markerForm">
                    <mat-form-field>
                        <input matInput formControlName="name" placeholder="Nom"/>
                    </mat-form-field>
                </div>
                <div class="description" [formGroup]="markerForm">
                    <mat-form-field>
                    <textarea cdkTextareaAutosize [cdkAutosizeMinRows]="4" [cdkAutosizeMaxRows]="10"
                              matInput formControlName="description" placeholder="Description"></textarea>
                    </mat-form-field>
                </div>
                <div class="color">
                    <input type="color" [ngModel]="selectedMarker.color" (ngModelChange)="changeSelectedMarkerColor($event)">
                </div>
                <div class="actions">
                    <button mat-button (click)="cancelEdit(selectedMarker)">ANNULER</button>
                    <button mat-button color="primary" (click)="saveMarker(selectedMarker)">CRÉER</button>
                </div>
            </div>
            <div *ngIf="!selectedMarker.editable">
                <h2>{{selectedMarker.name}}</h2>
                <div>
                    {{selectedMarker.description}}
                </div>
            </div>
        </ng-template>
    </mat-sidenav>
</mat-sidenav-container>


<div class="menu-button">
    <button color="primary" mat-mini-fab (click)="menuSidenav.toggle()" *ngIf="!menuSidenav.opened">
        <mat-icon>menu</mat-icon>
    </button>
</div>

<div class="menu-grid-placement" *ngIf="gridDisplayed && !menuSidenav.opened">
    <button color="primary" mat-mini-fab (click)="startDragGrid()" *ngIf="!isGridDraggable">
        <mat-icon>control_camera</mat-icon>
    </button>
    <button color="primary" mat-mini-fab (click)="stopDragGrid()" *ngIf="isGridDraggable">
        <mat-icon>stop</mat-icon>
    </button>
</div>
