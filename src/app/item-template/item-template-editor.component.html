<mat-card>
    <mat-card-title *ngIf="title">
        {{title}}
    </mat-card-title>
    <div class="name-line">
        <mat-form-field>
            <input matInput
                   placeholder="Nom de l'objet"
                   [(ngModel)]="itemTemplate.name"
                   type="text"/>
        </mat-form-field>
        <icon [icon]="itemTemplate.data.icon" (click)="openSelectIconDialog()"></icon>
    </div>
    <div class="not-identified-name-line">
        <mat-form-field>
            <input matInput
                   placeholder="Nom quand non identifié"
                   [(ngModel)]="itemTemplate.data.notIdentifiedName"/>
        </mat-form-field>
        <button mat-icon-button
                [disabled]="!itemTemplate.name"
                (click)="itemTemplate.data.notIdentifiedName = itemTemplate.name"
                matTooltip="Copier le nom de l'objet">
            <mat-icon>content_copy</mat-icon>
        </button>
        <button mat-icon-button
                [disabled]="!itemTemplate.name"
                (click)="automaticNotIdentifiedName()"
                matTooltip="Mettre un nom générique">
            <mat-icon>refresh</mat-icon>
        </button>
    </div>
    <div class="source-line">
        <mat-form-field>
            <mat-select placeholder="Source" [(ngModel)]="itemTemplate.source" (selectionChange)="changeSource($event.value)" required>
                <mat-option value="official" *ngIf="_loginService.currentLoggedUser?.admin">Officiel</mat-option>
                <mat-option value="community">Communautaire</mat-option>
                <mat-option value="private">Privé</mat-option>
            </mat-select>
        </mat-form-field>
    </div>
    <div class="price-line">
        <mat-form-field>
            <input matInput
                   placeholder="Prix"
                   [(ngModel)]="itemTemplate.data.price"
                   type="number"/>
            <span matSuffix>P.O.</span>
        </mat-form-field>
        <mat-form-field style="flex: 1 auto; margin-left: 10px">
            <input matInput
                   placeholder="Description"
                   [(ngModel)]="itemTemplate.data.description"/>
        </mat-form-field>
    </div>
    <div>
        <mat-form-field style="width: 100%">
            <input matInput
                   placeholder="Note"
                   [(ngModel)]="itemTemplate.data.note"/>
        </mat-form-field>
    </div>
</mat-card>

<mat-card>
    <mat-card-subtitle>Section</mat-card-subtitle>
    <mat-card-content class="section-list">
        <mat-form-field *ngIf="sections">
            <mat-select [(ngModel)]="selectedSection" placeholder="Section">
                <mat-option *ngFor="let section of sections" [value]="section">
                    {{section.name}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field *ngIf="selectedSection">
            <mat-select [(ngModel)]="itemTemplate.categoryId" placeholder="Sous section">
                <mat-option *ngFor="let category of selectedSection.categories" [value]="category.id">
                    {{category.name}}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </mat-card-content>
</mat-card>

<item-template-editor-module
    *ngFor="let moduleName of modules"
    [itemTemplate]="itemTemplate"
    [slots]="slots"
    [gods]="gods"
    [itemTypes]="itemTypes"
    [skills]="skills"
    [skillsById]="skillsById"
    (onDelete)="removeModule(moduleName)"
    [moduleName]="moduleName">
</item-template-editor-module>

<mat-divider></mat-divider>

<mat-card class="add-module-card">
    Ajouter un module
    <autocomplete-input [clearOnSelect]="true"
                        [placeholder]="'Module'"
                        (onSelect)="addModule($event)"
                        [(callback)]="autocompleteModuleCallback">
    </autocomplete-input>
</mat-card>


<ng-template cdk-portal #addModuleDialog="cdkPortal">
    <mat-card>
        Ajouter un module
        <autocomplete-input #autocompleteModuleModalTextField
                            [clearOnSelect]="true"
                            [placeholder]="'Module'"
                            (onSelect)="addModule($event)"
                            [(callback)]="autocompleteModuleCallback">
        </autocomplete-input>
    </mat-card>
</ng-template>

<h3 class="mat-h3">Aperçu</h3>

<item-template [jobsName]="jobsName"
               [originsName]="originsName"
               [godsByTechName]="godsByTechName"
               [itemTemplate]="itemTemplate">
</item-template>

