<mat-card>
  <mat-card-content>
    <div class="name-line">
      <mat-form-field>
        <!-- placeholder start with an invisible character so chrome autocomplete this field with user name -->
        <mat-label>&#x2063;Nom de l'objet</mat-label>
        <input matInput
          autocomplete="off"
          required
          [(ngModel)]="itemTemplate.name"/>
      </mat-form-field>
      <icon [icon]="itemTemplate.data.icon" (click)="openSelectIconDialog()"></icon>
    </div>
    <div class="not-identified-name-line">
      <mat-form-field>
        <!-- placeholder start with an invisible character so chrome autocomplete this field with user name -->
        <input matInput
          placeholder="&#x2063;Nom quand non identifié"
          autocomplete="off"
          [(ngModel)]="itemTemplate.data.notIdentifiedName"/>
      </mat-form-field>
      <button mat-icon-button
        [disabled]="!itemTemplate.name"
        (click)="itemTemplate.data.notIdentifiedName = itemTemplate.name"
        matTooltip="Copier le nom de l'objet">
        <mat-icon>content_copy</mat-icon>
      </button>
      <button mat-icon-button
        [disabled]="!itemTemplate.name"
        (click)="automaticNotIdentifiedName()"
        matTooltip="Mettre un nom générique">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
    <div class="source-line">
      <mat-form-field>
        <mat-select placeholder="Source" [(ngModel)]="itemTemplate.source" (selectionChange)="changeSource($event.value)" required>
          @if (loginService.currentLoggedUser?.admin) {
            <mat-option value="official">Officiel</mat-option>
          }
          <mat-option value="community">Communautaire</mat-option>
          <mat-option value="private">Privé</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="price-line">
      <mat-form-field>
        <input matInput
          autocomplete="off"
          placeholder="Prix"
          [(ngModel)]="itemTemplate.data.price"
          type="number"/>
        <span matSuffix>P.O.</span>
      </mat-form-field>
      <mat-form-field style="flex: 1 auto; margin-left: 10px">
        <input matInput
          autocomplete="off"
          placeholder="Description"
          [(ngModel)]="itemTemplate.data.description"/>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field style="width: 100%">
        <input matInput
          autocomplete="off"
          placeholder="Note"
          [(ngModel)]="itemTemplate.data.note"/>
      </mat-form-field>
    </div>
  </mat-card-content>
</mat-card>

<mat-card>
  <mat-card-header>
    <mat-card-title>Section</mat-card-title>
  </mat-card-header>
  <mat-card-content class="section-list">
    @if (sections) {
      <mat-form-field>
        <mat-select [(ngModel)]="selectedSection" placeholder="Section" required>
          @for (section of sections; track section) {
            <mat-option [value]="section">
              {{section.name}}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    }
    @if (selectedSection) {
      <mat-form-field>
        <mat-select [(ngModel)]="itemTemplate.subCategoryId" placeholder="Sous section" required>
          @for (subCategory of selectedSection.subCategories; track subCategory) {
            <mat-option [value]="subCategory.id">
              {{subCategory.name}}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    }
  </mat-card-content>
</mat-card>

@for (moduleName of modules; track moduleName) {
  <item-template-editor-module
    [itemTemplate]="itemTemplate"
    [slots]="slots"
    [gods]="gods"
    [itemTypes]="itemTypes"
    [skills]="skills"
    [skillsById]="skillsById"
    (deleted)="removeModule(moduleName)"
    [moduleName]="moduleName">
  </item-template-editor-module>
}

<button mat-raised-button (click)="openAddModuleDialog()">
  <mat-icon>add</mat-icon> Ajouter un module
</button>

<mat-card>
  @if (itemTemplate.source === 'community') {
    <mat-card-subtitle style="display: flex; align-items: center">
      <mat-icon>group</mat-icon>Object communautaire@if (itemTemplate.sourceUser) {
      <span>&nbsp;créé par {{itemTemplate.sourceUser}}</span>
    }
    </mat-card-subtitle>
  }
  @if (itemTemplate.source === 'private') {
    <mat-card-subtitle style="display: flex; align-items: center">
      <mat-icon>lock</mat-icon> Object privé
    </mat-card-subtitle>
  }
  <mat-card-header>
    <icon matCardAvatar [enchanted]="itemTemplate.data.enchantment !== undefined" [icon]="itemTemplate.data.icon" [size]="'40px'"></icon>
    <mat-card-title>
      {{itemTemplate.name}}
      @if (itemTemplate.data.enchantment !== undefined) {
        <span>(Ench. {{itemTemplate.data.enchantment}})</span>
      }
    </mat-card-title>
    <mat-card-subtitle>
      @if (itemTemplate.data.enchantment !== undefined) {
        <span>Enchanté </span>
      }
      @if (itemTemplate.data.requireLevel) {
        <span>Niveau {{itemTemplate.data.requireLevel}} </span>
      }
      @if (itemTemplate.data.relic) {
        <span>Relique </span>
      }
    </mat-card-subtitle>
    <span class="padding"></span>
  </mat-card-header>
  <mat-card-content>
    <app-item-template-details [itemTemplate]="itemTemplate"
                               [jobsName]="jobsName"
                               [godsByTechName]="godsByTechName"
                               [originsName]="originsName">
    </app-item-template-details>
  </mat-card-content>
</mat-card>
