<mat-card>
  <mat-card-header>
    <mat-card-title>
      {{monsterTemplate.name}}
    </mat-card-title>
    @if (isAdmin) {
      <button mat-icon-button [matMenuTriggerFor]="menuMonster" aria-label="Ouvrir le menu d'édition du monstre">
        <mat-icon>more_vert</mat-icon>
      </button>
    }
  </mat-card-header>
  <mat-menu #menuMonster="matMenu">
    <button mat-menu-item
      (click)="openEditMonsterDialog()">
      <mat-icon>edit</mat-icon>
      Éditer
    </button>
  </mat-menu>
  <mat-card-content>
    @if (monsterTemplate.data.special) {
      <div>{{monsterTemplate.data.note}}</div>
    }
    @if (!monsterTemplate.data.special) {
      <div class="section-title">
        Caractéristiques
      </div>
      <div class="section-content monster-stats-row">
        <div class="field at">
          <span class="label">AT</span>
          <span class="value">{{monsterTemplate.data.at}}</span>
        </div>
        @if (monsterTemplate.data.prd) {
          <div class="field prd">
            <span class="label">PRD</span>
            <span class="value">{{monsterTemplate.data.prd}}</span>
          </div>
        }
        @if (monsterTemplate.data.esq) {
          <div class="field esq">
            <span class="label">ESQ</span>
            <span class="value">{{monsterTemplate.data.esq}}</span>
          </div>
        }
        <div class="field ev">
          <span class="label">EV</span>
          <span class="value">{{monsterTemplate.data.ev}}</span>
        </div>
        @if (monsterTemplate.data.ea) {
          <div class="field ea">
            <span class="label">EA</span>
            <span class="value">{{monsterTemplate.data.ea}}</span>
          </div>
        }
        <div class="field pr">
          <span class="label">PR</span>
          <span class="value">
            {{monsterTemplate.data.pr}} @if (monsterTemplate.data.pr_magic) {
            <span>({{monsterTemplate.data.pr_magic}})</span>
          }
        </span>
      </div>
      <div class="field cou">
        <span class="label">COU</span>
        <span class="value">{{monsterTemplate.data.cou}}</span>
      </div>
      <div class="field xp">
        <span class="label">XP</span>
        <span class="value">{{monsterTemplate.data.xp}}</span>
      </div>
    </div>
    @if (monsterTemplate.data.dmg) {
      <div class="section-title">
        Dégât
      </div>
      <div class="section-content">{{monsterTemplate.data.dmg}}</div>
    }
    @if (monsterTemplate.data.note) {
      <div class="section-title">
        Note
      </div>
      <div class="section-content" [innerHTML]="monsterTemplate.data.note | markdown"></div>
    }
  }

  @if (traisById && monsterTemplate.data.traits && monsterTemplate.data.traits.length) {
    <div class="section-title">
      Traits
    </div>
    <div class="section-content monster-traits-row">
      @for (trait of monsterTemplate.data.traits; track trait) {
        <div>
          <monster-trait [trait]="traisById[trait.traitId]" [traitInfo]="trait"></monster-trait>
        </div>
      }
    </div>
  }

  @if (monsterTemplate.inventory && monsterTemplate.inventory.length) {
    <div>
      <div class="section-title">
        Inventaire
      </div>
      <div class="section-content">
        @for (inventoryElement of monsterTemplate.inventory; track inventoryElement) {
          <div class="inventory-element" mat-ripple (click)="openItemInfo(inventoryElement.itemTemplate)">
            <icon [icon]="inventoryElement.itemTemplate.data.icon"></icon>
            <span>
              @if (inventoryElement.minCount === inventoryElement.maxCount && inventoryElement.minCount !== 1) {
                <span>{{inventoryElement.minCount}}</span>
              }
              @if (inventoryElement.minCount !== inventoryElement.maxCount) {
                <span>{{inventoryElement.minCount}} - {{inventoryElement.maxCount}}</span>
              }
              {{inventoryElement.itemTemplate.name}}
              @if (inventoryElement.minUg !== undefined && inventoryElement.minUg !== inventoryElement.maxUg) {
                <span>({{inventoryElement.minUg}} - {{inventoryElement.maxUg}} U.G.)</span>
              }
              @if (inventoryElement.minUg !== undefined && inventoryElement.minUg === inventoryElement.maxUg) {
                <span>({{inventoryElement.minUg}} U.G.)</span>
              }
            </span>
            <span>{{inventoryElement.chance * 100 | number:'1.0-2'}}%</span>
          </div>
        }
      </div>
    </div>
  }
</mat-card-content>
</mat-card>

